{"pageProps":{"post":{"slug":"2019-10-06-nuxt-sharing-component","title":"Nuxt.js: sharing components","categories":["memo"],"ogImage":"https://koka831.github.io/img/icon.png","tags":["Vue"],"content":"<h2 id=\"abstract\"><a href=\"#abstract\">Abstract</a></h2>\n<ul>\n<li>single repositoryで複数のprojectを管理する</li>\n<li>ビルド時に<code class=\"language-unknown\">nuxt.config.js</code>を上書きし, <code class=\"language-unknown\">pages</code>をproject毎に分離</li>\n</ul>\n<h2 id=\"motivation\"><a href=\"#motivation\">Motivation</a></h2>\n<ul>\n<li><code class=\"language-unknown\">admin</code>と<code class=\"language-unknown\">user</code>で共通のコンポーネントがある</li>\n<li><code class=\"language-unknown\">/user</code>, <code class=\"language-unknown\">/admin</code> のようにルーティングで分ける方法もあるが, そもそも<code class=\"language-unknown\">/admin</code> を外に出したくない(同じ環境で動作させたくない)</li>\n</ul>\n<h3 id=\"1-setup-subdir\"><a href=\"#1-setup-subdir\">1. setup subdir</a></h3>\n<p><a href=\"https://github.com/nuxt/create-nuxt-app\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">create-nuxt-app</a>で生成したテンプレートを元に, <code class=\"language-unknown\">admin/</code>ディレクトリ配下にサブプロジェクトを作成する.</p>\n<div class=\"remark-highlight\"><pre class=\"language-sh\"><code class=\"language-sh\">$ mkdir -p admin/{pages,layouts}\n$ touch admin/app.config.js\n$ls\n.gitignore\n.nuxt/\nadmin/    &#x26;lt;-- new\n  layouts/\n  pages/\n  app.config.js\nassets/\ncomponents/\n...\nlayouts/  &#x26;lt;-- default\npages/    &#x26;lt;-- default\n</code></pre></div>\n<h3 id=\"2-configure-appconfigjs\"><a href=\"#2-configure-appconfigjs\">2. configure app.config.js</a></h3>\n<p><code class=\"language-unknown\">srcDir</code>を<code class=\"language-unknown\">admin</code>とすることで, Nuxtがみるプロジェクトが<code class=\"language-unknown\">admin/</code>配下になる.\nこれでNuxtが生成するroutingも<code class=\"language-unknown\">admin/pages</code>によるものになる.\nそのため, Storeをadmin側でも持ちたい場合は<code class=\"language-unknown\">admin/store/</code>を作成する.</p>\n<p>また, <code class=\"language-unknown\">admin/pages/xxx.vue</code> でも<code class=\"language-unknown\">import XXX from &#x26;#39;@/components/...</code>のように<code class=\"language-unknown\">@</code>を用いる為に<code class=\"language-unknown\">build</code>ディレクティブで<code class=\"language-unknown\">@ alias</code>を上書きする.<br>\n(この設定がない場合, <code class=\"language-unknown\">@/../components/...</code>のように root directoryまで1階層のぼる必要がある)</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> merge <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'deepmerge'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> nuxt <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../nuxt.config.js'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> extend <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  srcDir<span class=\"token operator\">:</span> __dirname<span class=\"token punctuation\">,</span>\n  buildDir<span class=\"token operator\">:</span> <span class=\"token string\">'.nuxt/admin'</span><span class=\"token punctuation\">,</span>\n\n  build<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">extend</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">config</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      config<span class=\"token punctuation\">.</span><span class=\"token property-access\">resolve</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">alias</span><span class=\"token punctuation\">[</span><span class=\"token string\">'@'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'..'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token function\">merge</span><span class=\"token punctuation\">(</span>nuxt<span class=\"token punctuation\">,</span> extend<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<h3 id=\"3-configure-packagejson\"><a href=\"#3-configure-packagejson\">3. configure package.json</a></h3>\n<p><code class=\"language-unknown\">nuxt</code>の<code class=\"language-unknown\">--config-file</code> オプションを用いて<code class=\"language-unknown\">nuxt.config.js</code>を指定する.<br>\nこれで<code class=\"language-unknown\">yarn dev</code>とすればデフォルトの<code class=\"language-unknown\">pages</code>が用いられるし, <code class=\"language-unknown\">yarn dev:admin</code>とすれば<code class=\"language-unknown\">admin/pages</code>が用いられる.</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"dev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"nuxt\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"build\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"nuxt build\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"start\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"nuxt start\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"dev:admin\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"nuxt --config-file admin/app.config.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"build:admin\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"nuxt build --config-file admin/app.config.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"start:admin\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"nuxt start --config-file admin/app.config.js\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token spread operator\">...</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h3 id=\"appendix-generated-routingnuxtadminrouterjs\"><a href=\"#appendix-generated-routingnuxtadminrouterjs\">Appendix: Generated Routing(.nuxt/admin/router.js)</a></h3>\n<p><code class=\"language-unknown\">yarn build:admin</code>で生成された<code class=\"language-unknown\">routes</code> に <code class=\"language-unknown\">client</code>側の<code class=\"language-unknown\">pages</code>が含まれていないことが確認できる.</p>\n<div class=\"remark-highlight\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token maybe-class-name\">Vue</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'vue'</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token maybe-class-name\">Router</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'vue-router'</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> interopDefault <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'./utils'</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\">scrollBehavior</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'./router.scrollBehavior.js'</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">_0510df08</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token function\">interopDefault</span><span class=\"token punctuation\">(</span><span class=\"token keyword module\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../../admin/pages/index.vue'</span> <span class=\"token comment\">/* webpackChunkName: \"pages/index\" */</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token maybe-class-name\">Vue</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">use</span><span class=\"token punctuation\">(</span><span class=\"token maybe-class-name\">Router</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword module\">export</span> <span class=\"token keyword\">const</span> routerOptions <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  mode<span class=\"token operator\">:</span> <span class=\"token string\">'history'</span><span class=\"token punctuation\">,</span>\n  base<span class=\"token operator\">:</span> <span class=\"token function\">decodeURI</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  linkActiveClass<span class=\"token operator\">:</span> <span class=\"token string\">'nuxt-link-active'</span><span class=\"token punctuation\">,</span>\n  linkExactActiveClass<span class=\"token operator\">:</span> <span class=\"token string\">'nuxt-link-exact-active'</span><span class=\"token punctuation\">,</span>\n  scrollBehavior<span class=\"token punctuation\">,</span>\n\n  routes<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n      path<span class=\"token operator\">:</span> <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span>\n      component<span class=\"token operator\">:</span> _0510df08<span class=\"token punctuation\">,</span>\n      name<span class=\"token operator\">:</span> <span class=\"token string\">\"index\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n  fallback<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword module\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">createRouter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Router</span><span class=\"token punctuation\">(</span>routerOptions<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h3 id=\"repository\"><a href=\"#repository\">repository</a></h3>\n<p><a href=\"https://github.com/koka831/nuxt-multiple-sample\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">koka831/nuxt-multiple-sample</a></p>","description":"simple way to share components between multiple projects","commits":[{"title":"fix","date":"  Thu Apr 22 00:55:54 2021","hash":"e3fbaa17","diff":"<div class=\"remark-highlight\"><pre data-file=\"e3fbaa17.patch\" class=\"language-git  language-diff\"><code class=\"language-git\"><span class=\"token commit-sha1\">commit e3fbaa17c115a1c6534cb3bcd8046413e7ec291e</span>\nAuthor: koka &#x3C;<a href=\"mailto:koka.code@gmail.com\" class=\"token email-link\">koka.code@gmail.com</a>>\nDate:   Thu Apr 22 00:55:54 2021 +0900\n\n  fix\n\ndiff --git a/_posts/2019-10-06-nuxt-sharing-component.md b/_posts/2019-10-06-nuxt-sharing-component.md\nnew file mode 100644\nindex 0000000..6daf63f\n<span class=\"token deleted\">--- /dev/null</span>\n<span class=\"token inserted\">+++ b/_posts/2019-10-06-nuxt-sharing-component.md</span>\n<span class=\"token coord\">@@ -0,0 +1,124 @@</span>\n<span class=\"token inserted\">+---</span>\n<span class=\"token inserted\">+title: 'Nuxt.js: sharing components'</span>\n<span class=\"token inserted\">+date: 2019-10-06</span>\n<span class=\"token inserted\">+categories:</span>\n<span class=\"token inserted\">+- memo</span>\n<span class=\"token inserted\">+tags:</span>\n<span class=\"token inserted\">+- Vue</span>\n<span class=\"token inserted\">+description: simple way to share components between multiple projects</span>\n<span class=\"token inserted\">+---</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+## Abstract</span>\n<span class=\"token inserted\">+- single repositoryで複数のprojectを管理する</span>\n<span class=\"token inserted\">+- ビルド時に`nuxt.config.js`を上書きし, `pages`をproject毎に分離</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+## Motivation</span>\n<span class=\"token inserted\">+- `admin`と`user`で共通のコンポーネントがある</span>\n<span class=\"token inserted\">+- `/user`, `/admin` のようにルーティングで分ける方法もあるが, そもそも`/admin` を外に出したくない(同じ環境で動作させたくない)</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+### 1. setup subdir</span>\n<span class=\"token inserted\">+[create-nuxt-app](https://github.com/nuxt/create-nuxt-app)で生成したテンプレートを元に, `admin/`ディレクトリ配下にサブプロジェクトを作成する.</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+ ```sh</span>\n<span class=\"token inserted\">+$ mkdir -p admin/{pages,layouts}</span>\n<span class=\"token inserted\">+$ touch admin/app.config.js</span>\n<span class=\"token inserted\">+$ls</span>\n<span class=\"token inserted\">+.gitignore</span>\n<span class=\"token inserted\">+.nuxt/</span>\n<span class=\"token inserted\">+admin/    &#x3C;-- new</span>\n<span class=\"token inserted\">+  layouts/</span>\n<span class=\"token inserted\">+  pages/</span>\n<span class=\"token inserted\">+  app.config.js</span>\n<span class=\"token inserted\">+assets/</span>\n<span class=\"token inserted\">+components/</span>\n<span class=\"token inserted\">+...</span>\n<span class=\"token inserted\">+layouts/  &#x3C;-- default</span>\n<span class=\"token inserted\">+pages/    &#x3C;-- default</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+ ```</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+### 2. configure app.config.js</span>\n<span class=\"token inserted\">+`srcDir`を`admin`とすることで, Nuxtがみるプロジェクトが`admin/`配下になる.</span>\n<span class=\"token inserted\">+これでNuxtが生成するroutingも`admin/pages`によるものになる.</span>\n<span class=\"token inserted\">+そのため, Storeをadmin側でも持ちたい場合は`admin/store/`を作成する.</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+また, `admin/pages/xxx.vue` でも`import XXX from '@/components/...`のように`@`を用いる為に`build`ディレクティブで`@ alias`を上書きする.  </span>\n<span class=\"token inserted\">+(この設定がない場合, `@/../components/...`のように root directoryまで1階層のぼる必要がある)</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+ ```js</span>\n<span class=\"token inserted\">+const path = require('path')</span>\n<span class=\"token inserted\">+const merge = require('deepmerge')</span>\n<span class=\"token inserted\">+const nuxt = require('../nuxt.config.js')</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+const extend = {</span>\n<span class=\"token inserted\">+  srcDir: __dirname,</span>\n<span class=\"token inserted\">+  buildDir: '.nuxt/admin',</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+  build: {</span>\n<span class=\"token inserted\">+    extend(config) {</span>\n<span class=\"token inserted\">+      config.resolve.alias['@'] = path.resolve(__dirname, '..')</span>\n<span class=\"token inserted\">+    }</span>\n<span class=\"token inserted\">+  }</span>\n<span class=\"token inserted\">+}</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+export default merge(nuxt, extend)</span>\n<span class=\"token inserted\">+ ```</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+### 3. configure package.json</span>\n<span class=\"token inserted\">+`nuxt`の`--config-file` オプションを用いて`nuxt.config.js`を指定する.  </span>\n<span class=\"token inserted\">+これで`yarn dev`とすればデフォルトの`pages`が用いられるし, `yarn dev:admin`とすれば`admin/pages`が用いられる.</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+ ```js</span>\n<span class=\"token inserted\">+{</span>\n<span class=\"token inserted\">+  \"scripts\": {</span>\n<span class=\"token inserted\">+    \"dev\": \"nuxt\",</span>\n<span class=\"token inserted\">+    \"build\": \"nuxt build\",</span>\n<span class=\"token inserted\">+    \"start\": \"nuxt start\",</span>\n<span class=\"token inserted\">+    \"dev:admin\": \"nuxt --config-file admin/app.config.js\",</span>\n<span class=\"token inserted\">+    \"build:admin\": \"nuxt build --config-file admin/app.config.js\",</span>\n<span class=\"token inserted\">+    \"start:admin\": \"nuxt start --config-file admin/app.config.js\",</span>\n<span class=\"token inserted\">+  },</span>\n<span class=\"token inserted\">+  ...</span>\n<span class=\"token inserted\">+}</span>\n<span class=\"token inserted\">+ ```</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+### Appendix: Generated Routing(.nuxt/admin/router.js)</span>\n<span class=\"token inserted\">+`yarn build:admin`で生成された`routes` に `client`側の`pages`が含まれていないことが確認できる.</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+ ```js</span>\n<span class=\"token inserted\">+import Vue from 'vue'</span>\n<span class=\"token inserted\">+import Router from 'vue-router'</span>\n<span class=\"token inserted\">+import { interopDefault } from './utils'</span>\n<span class=\"token inserted\">+import scrollBehavior from './router.scrollBehavior.js'</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+const _0510df08 = () => interopDefault(import('../../admin/pages/index.vue' /* webpackChunkName: \"pages/index\" */))</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+Vue.use(Router)</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+export const routerOptions = {</span>\n<span class=\"token inserted\">+  mode: 'history',</span>\n<span class=\"token inserted\">+  base: decodeURI('/'),</span>\n<span class=\"token inserted\">+  linkActiveClass: 'nuxt-link-active',</span>\n<span class=\"token inserted\">+  linkExactActiveClass: 'nuxt-link-exact-active',</span>\n<span class=\"token inserted\">+  scrollBehavior,</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+  routes: [{</span>\n<span class=\"token inserted\">+      path: \"/\",</span>\n<span class=\"token inserted\">+      component: _0510df08,</span>\n<span class=\"token inserted\">+      name: \"index\"</span>\n<span class=\"token inserted\">+    }],</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+  fallback: false</span>\n<span class=\"token inserted\">+}</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+export function createRouter() {</span>\n<span class=\"token inserted\">+  return new Router(routerOptions)</span>\n<span class=\"token inserted\">+}</span>\n<span class=\"token inserted\">+ ```</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+### repository</span>\n<span class=\"token inserted\">+[koka831/nuxt-multiple-sample](https://github.com/koka831/nuxt-multiple-sample)</span>\n</code></pre></div>"}],"publishedAt":"Sun Oct 06 2019","updatedAt":"Thu Apr 22 2021"}},"__N_SSG":true}