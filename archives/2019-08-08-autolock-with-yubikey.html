<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta name="description" content="my log"/><meta name="theme-color" content="#ddd4bb"/><meta property="og:type" content="website"/><meta property="og:url" content="https://koka.dev"/><meta property="og:description" content="my log"/><meta property="og:site_name" content="/var/log/koka"/><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="/var/log/koka"/><meta name="twitter:site" content="@k_0ka"/><meta name="twitter:description" content="my log"/><link rel="alternate" type="application/rss+xml" href="https://koka831.github.io/feed.xml" title="/var/log/koka RSS2.0"/><title>Linux: Login/sudo with Yubikey | /var/log/koka</title><meta property="title" content="Linux: Login/sudo with Yubikey"/><meta property="og:title" content="Linux: Login/sudo with Yubikey"/><meta property="og:image" content="https://koka831.github.io/img/icon.png"/><meta name="next-head-count" content="17"/><link rel="preload" href="/blog/_next/static/css/e36a84cff8eb786dd838.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/e36a84cff8eb786dd838.css" data-n-g=""/><link rel="preload" href="/blog/_next/static/css/254f17c58cfd700a35b7.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/254f17c58cfd700a35b7.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/blog/_next/static/chunks/webpack-db5e9e5b812b68fa5741.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/framework-fa084fb9440caadd7405.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/commons-42870b5cbd0a37235f4f.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/main-6f040fcbb9831e40a9fd.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/pages/_app-5f44d4623abad7e89937.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/148-666076dd1d6135e3d14f.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/pages/archives/%5Bslug%5D-88d5fadb35297e43b6c3.js" as="script"/></head><body><div id="__next"><nav class="Header_navigation__container__3D5xg"><div class="Header_navigation__16lxy"><a href="/blog">/var/log/koka</a></div><div><a href="/blog/archives">archive</a></div></nav><main class="Layout_container__QVNsN"><div class="slug_container__2Nysm"><div class="slug_main__1TLKU"><article class="slug_article__3n4cv" role="article"><header itemscope="" class="ArticleHeader_header__container__AO3KC"><h1 class="ArticleHeader_post__title__2ujta">Linux: Login/sudo with Yubikey</h1><div class="ArticleHeader_flex__36wQ5"><div><div class="ArticleHeader_post__tags__18geI"><p class="Tag_tag__FntIt">Linux</p><p class="Tag_tag__FntIt">udev</p><p class="Tag_tag__FntIt">yubikey</p></div></div><div class="ArticleHeader_post__dates__s80K2"><time dateTime="Thu Aug 08 2019" itemProp="datePublished" class="PublishDate_post__date__2Kcmg">published: <!-- -->Thu Aug 08 2019</time><time dateTime="Sat Apr 10 2021" itemProp="datePublished" class="PublishDate_post__date__2Kcmg">updated: Sat Apr 10 2021</time></div></div></header><div><h2 id="abstract"><a href="#abstract">Abstract</a></h2>
<ul>
<li>Linux Desktopのログイン時及び<code class="language-unknown">sudo</code>時にYubikey + Passwordを必須にしてみた.</li>
<li>ログインした状態でYubikeyを抜くとlockするようにした.</li>
</ul>
<h2 id="env"><a href="#env">Env</a></h2>
<ul>
<li>Ubuntu 18.04</li>
<li>FIDO U2F Security Key(自分は<a href="https://www.amazon.co.jp/dp/B06XHTKFH3/ref=cm_sw_em_r_mt_dp_U_Ha5sDbS6H12P6" target="_blank" rel="nofollow noopener noreferrer">これ</a>つかってます. 端子ガードついてるKey他にも出てほしい)</li>
</ul>
<h2 id="install-dependencies"><a href="#install-dependencies">Install Dependencies</a></h2>
<div class="remark-highlight"><pre data-file="terminal" class="language-shell-session"><code class="language-shell-session"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">sudo</span> add-apt-repository ppa:yubico/stable</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> yubikey-manager-qt yubioath-desktop yubikey-personalization-gui</span></span>
</code></pre></div>
<h2 id="setup-u2f-key"><a href="#setup-u2f-key">Setup U2F Key</a></h2>
<h3 id="u2f-keyの登録"><a href="#u2f-key%E3%81%AE%E7%99%BB%E9%8C%B2">U2F Keyの登録</a></h3>
<div class="remark-highlight"><pre data-file="terminal" class="language-shell-session"><code class="language-shell-session"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">mkdir</span> -p <span class="token environment constant">$HOME</span>/.config/Yubico</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">pamu2fcfg -u<span class="token variable">${<span class="token environment constant">USER</span>}</span> <span class="token operator">></span> <span class="token environment constant">$HOME</span>/.config/Yubico/u2f_keys</span></span>
</code></pre></div>
<p>またバックアップデバイスを追加する場合には<code class="language-unknown">--nouser</code>をつけて追記<sup id="fnref-pamu2fcfg"><a href="#fn-pamu2fcfg" class="footnote-ref">pamu2fcfg</a></sup>.</p>
<div class="remark-highlight"><pre data-file="terminal" class="language-shell-session"><code class="language-shell-session"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">pamu2fcfg -n <span class="token operator">>></span> <span class="token environment constant">$HOME</span>/.config/Yubico/u2f_keys</span></span>
</code></pre></div>
<h3 id="u2f-for-sudo"><a href="#u2f-for-sudo">U2F for SUDO</a></h3>
<p>以下の6行目を追記. PAM(Pluggable Authentication Modules)での認証において，password入力後にYubikeyがrequireされるようになる(Yubikeyが無いとauthできない).</p>
<p><strong><code class="language-unknown">/etc/pam.d/sudo</code></strong></p>
<div class="remark-highlight"><pre data-file="/etc/pam.d/sudo" class="language-diff"><code class="language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span>#%PAM-1.0
</span>
<span class="token unchanged"><span class="token prefix unchanged"> </span>session    required    pam_env.so readenv=1 user_readenv=0
<span class="token prefix unchanged"> </span>session    required    pam_env.so readenv=1 envfile=/etc/default/locale user_readenv=0
<span class="token prefix unchanged"> </span>@include   common-auth
</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>auth       required    pam_u2f.so
</span><span class="token unchanged"><span class="token prefix unchanged"> </span>@include   common-account
<span class="token prefix unchanged"> </span>@include   common-session-noninteractive</span>
</code></pre></div>
<h3 id="u2f-for-login"><a href="#u2f-for-login">U2F for Login</a></h3>
<p>Display ManagerにGDM(Gnome Display Manager)を用いている場合は以下のファイルに<code class="language-unknown">pam_u2f.so</code>の行を追記する.<br>
<strong><code class="language-unknown">/etc/pam.d/gdm-password</code></strong>
その他のDMを用いている場合(KDE等)は <strong><code class="language-unknown">/etc/pam.d/lightdm</code></strong> に追記する.</p>
<div class="remark-highlight"><pre data-file="/etc/pam.d/gdm-password" class="language-diff"><code class="language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span>#%PAM-1.0
<span class="token prefix unchanged"> </span>auth     requisite       pam_nologin.so
<span class="token prefix unchanged"> </span>auth     required        pam_succeed_if.so user != root quiet_success
<span class="token prefix unchanged"> </span>@include common-auth
</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>auth     required        pam_u2f.so
</span><span class="token unchanged"><span class="token prefix unchanged"> </span>auth     optional        pam_gnome_keyring.so
<span class="token prefix unchanged"> </span>@include common-account
<span class="token prefix unchanged"> </span>...omit</span>
</code></pre></div>
<h2 id="auto-lock-without-u2f"><a href="#auto-lock-without-u2f">Auto-lock without U2F</a></h2>
<p>ここからが本題. U2F Keyの接続が解除されると端末をロックする.</p>
<p>もともと自分の使っているLaptopには指紋認証センサが付属している．一般に生体認証はU2Fよりもセキュアであるし，自分も異論はない.<br>
ではU2Fが生体認証より優れている点はなにか. 自分の答えは認証の持続性をコントロールできる点である.</p>
<p>指紋認証を例に取ると，一度ログインした端末は一定時間操作をしない際のオートロックまたはユーザ自身の能動的なログアウトをしない限り，認証を再度必要としない.<br>
対してU2Fでは<strong>デバイスが接続されている間だけ認証されている</strong>という状態をもたらすことができる.</p>
<p>Apple Watchを身に着けた状態でMacの自動ログインが可能<sup id="fnref-applewatch"><a href="#fn-applewatch" class="footnote-ref">applewatch</a></sup>という例がある.
これはbluetooth接続したU2Fデバイスが一定距離離れるもしくはUSB接続したデバイスをejectすることで端末からログアウトする，という仕様で再現できる.</p>
<h3 id="monitoring-u2f-key-by-udev"><a href="#monitoring-u2f-key-by-udev">monitoring U2F key by udev</a></h3>
<p>U2F Keyモニターをudevに任せることにする. まず対象のIDを特定する.
<code class="language-unknown">udevadm monitor</code>でudevのイベントをモニタリングした状態でU2F Keyを抜き差しすると <code class="language-unknown">bind</code>, <code class="language-unknown">remove</code> イベントが通知されるので， <code class="language-unknown">$ID_MODEL_ID</code> 及び <code class="language-unknown">$ID_VENDOR_ID</code> を取得する.</p>
<div class="remark-highlight"><pre data-file="terminal" class="language-shell-session"><code class="language-shell-session"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">udevadm monitor --environment --udev</span></span>

<span class="token output">UDEV  [28028.490650] bind     /devices/pci0000:00/0000:00:14.0/usb1/1-3 (usb)</span>
<span class="token output">ACTION=bind</span>
<span class="token output">BUSNUM=001</span>
<span class="token output">DEVNAME=/dev/bus/usb/001/013</span>
<span class="token output">DEVNUM=013</span>
<span class="token output">DEVPATH=/devices/pci0000:00/0000:00:14.0/usb1/1-3</span>
<span class="token output">DEVTYPE=usb_device</span>
<span class="token output">DRIVER=usb</span>
<span class="token output">ID_BUS=usb</span>
<span class="token output">ID_MODEL=XXXXX</span>
<span class="token output">ID_MODEL_ENC=XXXXX</span>
<span class="token output">ID_MODEL_ID=f025</span>
<span class="token output">ID_REVISION=0100</span>
<span class="token output">ID_SERIAL=ExcelSecu_EsecuFIDO_HID</span>
<span class="token output">ID_USB_INTERFACES=:030000:</span>
<span class="token output">ID_VENDOR=ExcelSecu</span>
<span class="token output">ID_VENDOR_ENC=ExcelSecu</span>
<span class="token output">ID_VENDOR_ID=1ea8</span>
<span class="token output">MAJOR=189</span>
<span class="token output">MINOR=12</span>
<span class="token output">PRODUCT=1ea8/f025/100</span>
<span class="token output">SEQNUM=12938</span>
<span class="token output">SUBSYSTEM=usb</span>
<span class="token output">TYPE=0/0/0</span>
<span class="token output">USEC_INITIALIZED=28027949334</span>
</code></pre></div>
<p>上記の例では <code class="language-unknown">ID_MODEL_ID=f025</code>，<code class="language-unknown">ID_VENDOR_ID=1ea8</code> となっている.
このIDペアを用いて，U2F Key解除時の<code class="language-unknown">udev</code>ルールを作成する.</p>
<p><strong><code class="language-unknown">/etc/udev/rules.d/xx-u2fkey.rules</code></strong> (xxは適当な数字)</p>
<div class="remark-highlight"><pre data-file="/etc/udev/rules.d/xx-u2fkey.rules" class="language-config"><code class="language-config">ACTION==&#x26;quot;remove&#x26;quot;, ENV{ID_VENDOR_ID}==&#x26;quot;1ea8&#x26;quot;, ENV{ID_MODEL_ID}==&#x26;quot;f025&#x26;quot;, RUN+=&#x26;quot;/usr/local/bin/i3lock&#x26;quot;</code></pre></div>
<p>最後にrulesを登録し完了.</p>
<div class="remark-highlight"><pre data-file="terminal" class="language-shell-session"><code class="language-shell-session"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">udevadm control --reload-rules</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">service</span> udev reload</span></span>
</code></pre></div>
<hr>
<p>フリーランスという職業柄，PCを所持して企業へ出向くことが多くどうやってセキュリティ担保するかなーと考えてたところ<code class="language-unknown">pamu2fcfg</code>を見かけたので試してみた.<br>
Yubikeyを忘れて外出するという失態を犯した<sup id="fnref-twi"><a href="#fn-twi" class="footnote-ref">twi</a></sup>ので既に運用が危ういがデータは守れてるのでよし(よくないが)</p>
<h2 id="reference"><a href="#reference">Reference</a></h2>
<ul>
<li><a href="https://wiki.gentoo.org/wiki/Pam_u2f" target="_blank" rel="nofollow noopener noreferrer">Enable FIDO U2F USB support</a></li>
<li><a href="https://support.yubico.com/support/solutions/articles/15000010964-enabling-the-yubico-ppa-on-ubuntu" target="_blank" rel="nofollow noopener noreferrer">support.yubico.com#enabling the Yubico PPA on Ubuntu</a></li>
<li><a href="https://support.yubico.com/support/solutions/articles/15000011356-ubuntu-linux-login-guide-u2f" target="_blank" rel="nofollow noopener noreferrer">support.yubico.com#Ubuntu Linux Login Guide - U2F</a></li>
</ul>
<div class="footnotes">
<hr>
<ol>
<li id="fn-pamu2fcfg"><a href="https://developers.yubico.com/pam-u2f/Manuals/pamu2fcfg.1.html" target="_blank" rel="nofollow noopener noreferrer">developers.yubico.com/pam-u2f/Manuals/pamu2fcfg.1.html</a><a href="#fnref-pamu2fcfg" class="footnote-backref">↩</a></li>
<li id="fn-applewatch"><a href="https://support.apple.com/ja-jp/HT206995" target="_blank" rel="nofollow noopener noreferrer">support.apple.com/ja-jp/HT206995</a><a href="#fnref-applewatch" class="footnote-backref">↩</a></li>
<li id="fn-twi"><a href="https://twitter.com/k_0ka/status/1159312312156561408" target="_blank" rel="nofollow noopener noreferrer">twitter.com/k_0ka/status/1159312312156561408</a><a href="#fnref-twi" class="footnote-backref">↩</a></li>
</ol>
</div></div></article><div class="CommitLogs_commit_logs__2xJyI" role="log"><h2>Commits</h2><details><summary><span class="CommitLogs_commit__date__Vg5RN">  Sat Apr 10 17:49:51 2021</span><span class="CommitLogs_commit__hash__2k3a3">7fc1fe90</span><span class="CommitLogs_commit__message__nS85e">update</span></summary><p><div class="remark-highlight"><pre data-file="7fc1fe90.patch" class="language-git  language-diff"><code class="language-git"><span class="token commit-sha1">commit 7fc1fe9095a4a16d5b29f42b7ce90933aa17d91e</span>
Author: koka &#x3C;<a href="mailto:koka.code@gmail.com" class="token email-link">koka.code@gmail.com</a>>
Date:   Sat Apr 10 17:49:51 2021 +0900

  update

diff --git a/_posts/2019-08-08-autolock-with-yubikey.md b/_posts/2019-08-08-autolock-with-yubikey.md
index f40e591..e3bfc43 100644
<span class="token deleted">--- a/_posts/2019-08-08-autolock-with-yubikey.md</span>
<span class="token inserted">+++ b/_posts/2019-08-08-autolock-with-yubikey.md</span>
@@ -20,7 +20,7 @@ description: Yubikeyを自宅に忘れて１敗

<span class="token comment">## Install Dependencies</span>

<span class="token deleted">- ```sh</span>
<span class="token inserted">+ ```shell-session[data-file="terminal"]</span>
$ sudo add-apt-repository ppa:yubico/stable
$ sudo apt-get install yubikey-manager-qt yubioath-desktop yubikey-personalization-gui
</code></pre></div>
<p>@@ -28,14 +28,14 @@ $ sudo apt-get install yubikey-manager-qt yubioath-desktop yubikey-personalizati</p>
<h2 id="setup-u2f-key"><a href="#setup-u2f-key">Setup U2F Key</a></h2>
<h3 id="u2f-keyの登録"><a href="#u2f-key%E3%81%AE%E7%99%BB%E9%8C%B2">U2F Keyの登録</a></h3>
<ul>
<li>
<div class="remark-highlight"><pre class="language-sh"><code class="language-sh">undefined</code></pre></div>
</li>
</ul>
<ul>
<li>
<div class="remark-highlight"><pre data-file="terminal" class="language-shell-session"><code class="language-shell-session"><span class="command-line-prompt"></span>
</code></pre></div>
</li>
</ul>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mi>k</mi><mi>d</mi><mi>i</mi><mi>r</mi><mo>−</mo><mi>p</mi></mrow><annotation encoding="application/x-tex">mkdir -p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">p</span></span></span></span></span>HOME/.config/Yubico
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>a</mi><mi>m</mi><mi>u</mi><mn>2</mn><mi>f</mi><mi>c</mi><mi>f</mi><mi>g</mi><mo>−</mo><mi>u</mi></mrow><annotation encoding="application/x-tex"> pamu2fcfg -u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">a</span><span class="mord mathnormal">m</span><span class="mord mathnormal">u</span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">u</span></span></span></span></span>{USER} > $HOME/.config/Yubico/u2f_keys</p>
<div class="remark-highlight"><pre class="language-unknown"><code class="language-unknown">
またバックアップデバイスを追加する場合には`--nouser`をつけて追記[^pamu2fcfg].

- ```sh
+ ```shell-session[data-file=&#x26;quot;terminal&#x26;quot;]
$ pamu2fcfg -n &#x26;gt;&#x26;gt; $HOME/.config/Yubico/u2f_keys</code></pre></div>
<p>@@ -44,7 +44,7 @@ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>a</mi><mi>m</mi><mi>u</mi><mn>2</mn><mi>f</mi><mi>c</mi><mi>f</mi><mi>g</mi><mo>−</mo><mi>n</mi><mo>></mo><mo>></mo></mrow><annotation encoding="application/x-tex">pamu2fcfg -n >></annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">a</span><span class="mord mathnormal">m</span><span class="mord mathnormal">u</span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">></span></span><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">></span></span></span></span></span>HOME/.config/Yubico/u2f_keys</p>
<p><strong><code class="language-unknown">/etc/pam.d/sudo</code></strong></p>
<ul>
<li>
<div class="remark-highlight"><pre class="language-diff"><code class="language-diff"><span class="command-line-prompt"></span>
</code></pre></div>
</li>
</ul>
<ul>
<li>
<div class="remark-highlight"><pre data-file="/etc/pam.d/sudo" class="language-diff"><code class="language-diff">#%PAM-1.0

session    required    pam_env.so readenv=1 user_readenv=0
</code></pre></div>
</li>
</ul>
<p>@@ -61,7 +61,7 @@ Display ManagerにGDM(Gnome Display Manager)を用いている場合は以下の
その他のDMを用いている場合(KDE等)は <strong><code class="language-unknown">/etc/pam.d/lightdm</code></strong> に追記する.</p>
<ul>
<li>
<div class="remark-highlight"><pre class="language-diff"><code class="language-diff"><span class="command-line-prompt"></span>
</code></pre></div>
</li>
</ul>
<ul>
<li>
<div class="remark-highlight"><pre data-file="/etc/pam.d/gdm-password" class="language-diff"><code class="language-diff">#%PAM-1.0
auth     requisite       pam_nologin.so
auth     required        pam_succeed_if.so user != root quiet_success
</code></pre></div>
</li>
</ul>
<p>@@ -88,7 +88,7 @@ Apple Watchを身に着けた状態でMacの自動ログインが可能[^applewa
U2F Keyモニターをudevに任せることにする. まず対象のIDを特定する.
<code class="language-unknown">udevadm monitor</code>でudevのイベントをモニタリングした状態でU2F Keyを抜き差しすると <code class="language-unknown">bind</code>, <code class="language-unknown">remove</code> イベントが通知されるので， <code class="language-unknown">$ID_MODEL_ID</code> 及び <code class="language-unknown">$ID_VENDOR_ID</code> を取得する.</p>
<ul>
<li>
<div class="remark-highlight"><pre class="language-sh"><code class="language-sh">undefined</code></pre></div>
</li>
</ul>
<ul>
<li>
<div class="remark-highlight"><pre data-file="terminal" class="language-shell-session"><code class="language-shell-session"><span class="command-line-prompt"></span>
</code></pre></div>
</li>
</ul>
<p>$ udevadm monitor --environment --udev</p>
<p>UDEV  [28028.490650] bind     /devices/pci0000:00/0000:00:14.0/usb1/1-3 (usb)
@@ -123,13 +123,13 @@ USEC_INITIALIZED=28027949334</p>
<p><strong><code class="language-unknown">/etc/udev/rules.d/xx-u2fkey.rules</code></strong> (xxは適当な数字)</p>
<ul>
<li>
<div class="remark-highlight"><pre class="language-config"><code class="language-config">undefined</code></pre></div>
</li>
</ul>
<ul>
<li>
<div class="remark-highlight"><pre data-file="/etc/udev/rules.d/xx-u2fkey.rules" class="language-config"><code class="language-config">undefined</code></pre></div>
</li>
</ul>
<p>ACTION=="remove", ENV{ID_VENDOR_ID}=="1ea8", ENV{ID_MODEL_ID}=="f025", RUN+="/usr/local/bin/i3lock"</p>
<div class="remark-highlight"><pre class="language-unknown"><code class="language-unknown">
最後にrulesを登録し完了.

- ```sh
+ ```shell-session[data-file=&#x26;quot;terminal&#x26;quot;]
$ udevadm control --reload-rules
$ service udev reload</code></pre></div>
<div class="remark-highlight"><pre class="language-unknown"><code class="language-unknown">undefined</code></pre></div></p></details><details><summary><span class="CommitLogs_commit__date__Vg5RN">  Sat Jan 30 22:18:17 2021</span><span class="CommitLogs_commit__hash__2k3a3">35b550ae</span><span class="CommitLogs_commit__message__nS85e">copy md</span></summary><p><div class="remark-highlight"><pre data-file="35b550ae.patch" class="language-git  language-diff"><code class="language-git"><span class="token commit-sha1">commit 35b550ae83af4efaeadf33471c8ca8a32c1079c8</span>
Author: koka &#x3C;<a href="mailto:koka.code@gmail.com" class="token email-link">koka.code@gmail.com</a>>
Date:   Sat Jan 30 22:18:17 2021 +0900

  copy md

diff --git a/_posts/2019-08-08-autolock-with-yubikey.md b/_posts/2019-08-08-autolock-with-yubikey.md
new file mode 100644
index 0000000..f40e591
<span class="token deleted">--- /dev/null</span>
<span class="token inserted">+++ b/_posts/2019-08-08-autolock-with-yubikey.md</span>
<span class="token coord">@@ -0,0 +1,148 @@</span>
<span class="token inserted">+---</span>
<span class="token inserted">+title: 'Linux: Login/sudo with Yubikey'</span>
<span class="token inserted">+date: 2019-08-08</span>
<span class="token inserted">+categories:</span>
<span class="token inserted">+- diary</span>
<span class="token inserted">+tags:</span>
<span class="token inserted">+- Linux</span>
<span class="token inserted">+- udev</span>
<span class="token inserted">+- yubikey</span>
<span class="token inserted">+description: Yubikeyを自宅に忘れて１敗</span>
<span class="token inserted">+---</span>
<span class="token inserted">+</span>
<span class="token inserted">+## Abstract</span>
<span class="token inserted">+- Linux Desktopのログイン時及び`sudo`時にYubikey + Passwordを必須にしてみた.</span>
<span class="token inserted">+- ログインした状態でYubikeyを抜くとlockするようにした.</span>
<span class="token inserted">+</span>
<span class="token inserted">+## Env</span>
<span class="token inserted">+- Ubuntu 18.04</span>
<span class="token inserted">+- FIDO U2F Security Key(自分は[これ](https://www.amazon.co.jp/dp/B06XHTKFH3/ref=cm_sw_em_r_mt_dp_U_Ha5sDbS6H12P6)つかってます. 端子ガードついてるKey他にも出てほしい)</span>
<span class="token inserted">+</span>
<span class="token inserted">+## Install Dependencies</span>
<span class="token inserted">+</span>
<span class="token inserted">+ ```sh</span>
<span class="token inserted">+$ sudo add-apt-repository ppa:yubico/stable</span>
<span class="token inserted">+$ sudo apt-get install yubikey-manager-qt yubioath-desktop yubikey-personalization-gui</span>
<span class="token inserted">+ ```</span>
<span class="token inserted">+</span>
<span class="token inserted">+## Setup U2F Key</span>
<span class="token inserted">+### U2F Keyの登録</span>
<span class="token inserted">+</span>
<span class="token inserted">+ ```sh</span>
<span class="token inserted">+$ mkdir -p $HOME/.config/Yubico</span>
<span class="token inserted">+$ pamu2fcfg -u${USER} > $HOME/.config/Yubico/u2f_keys</span>
<span class="token inserted">+ ```</span>
<span class="token inserted">+</span>
<span class="token inserted">+またバックアップデバイスを追加する場合には`--nouser`をつけて追記[^pamu2fcfg].</span>
<span class="token inserted">+</span>
<span class="token inserted">+ ```sh</span>
<span class="token inserted">+$ pamu2fcfg -n >> $HOME/.config/Yubico/u2f_keys</span>
<span class="token inserted">+ ```</span>
<span class="token inserted">+</span>
<span class="token inserted">+### U2F for SUDO</span>
<span class="token inserted">+以下の6行目を追記. PAM(Pluggable Authentication Modules)での認証において，password入力後にYubikeyがrequireされるようになる(Yubikeyが無いとauthできない).</span>
<span class="token inserted">+</span>
<span class="token inserted">+**`/etc/pam.d/sudo`**</span>
<span class="token inserted">+</span>
<span class="token inserted">+ ```diff</span>
<span class="token inserted">+ #%PAM-1.0</span>
<span class="token inserted">+</span>
<span class="token inserted">+ session    required    pam_env.so readenv=1 user_readenv=0</span>
<span class="token inserted">+ session    required    pam_env.so readenv=1 envfile=/etc/default/locale user_readenv=0</span>
<span class="token inserted">+ @include   common-auth</span>
<span class="token inserted">++auth       required    pam_u2f.so</span>
<span class="token inserted">+ @include   common-account</span>
<span class="token inserted">+ @include   common-session-noninteractive</span>
<span class="token inserted">+ ```</span>
<span class="token inserted">+</span>
<span class="token inserted">+### U2F for Login</span>
<span class="token inserted">+Display ManagerにGDM(Gnome Display Manager)を用いている場合は以下のファイルに`pam_u2f.so`の行を追記する.  </span>
<span class="token inserted">+**`/etc/pam.d/gdm-password`**</span>
<span class="token inserted">+その他のDMを用いている場合(KDE等)は **`/etc/pam.d/lightdm`** に追記する.</span>
<span class="token inserted">+</span>
<span class="token inserted">+</span>
<span class="token inserted">+ ```diff</span>
<span class="token inserted">+ #%PAM-1.0</span>
<span class="token inserted">+ auth     requisite       pam_nologin.so</span>
<span class="token inserted">+ auth     required        pam_succeed_if.so user != root quiet_success</span>
<span class="token inserted">+ @include common-auth</span>
<span class="token inserted">++auth     required        pam_u2f.so</span>
<span class="token inserted">+ auth     optional        pam_gnome_keyring.so</span>
<span class="token inserted">+ @include common-account</span>
<span class="token inserted">+ ...omit</span>
<span class="token inserted">+ ```</span>
<span class="token inserted">+</span>
<span class="token inserted">+## Auto-lock without U2F</span>
<span class="token inserted">+ここからが本題. U2F Keyの接続が解除されると端末をロックする.  </span>
<span class="token inserted">+</span>
<span class="token inserted">+もともと自分の使っているLaptopには指紋認証センサが付属している．一般に生体認証はU2Fよりもセキュアであるし，自分も異論はない.  </span>
<span class="token inserted">+ではU2Fが生体認証より優れている点はなにか. 自分の答えは認証の持続性をコントロールできる点である.  </span>
<span class="token inserted">+</span>
<span class="token inserted">+指紋認証を例に取ると，一度ログインした端末は一定時間操作をしない際のオートロックまたはユーザ自身の能動的なログアウトをしない限り，認証を再度必要としない.  </span>
<span class="token inserted">+対してU2Fでは**デバイスが接続されている間だけ認証されている**という状態をもたらすことができる.</span>
<span class="token inserted">+</span>
<span class="token inserted">+Apple Watchを身に着けた状態でMacの自動ログインが可能[^applewatch]という例がある.</span>
<span class="token inserted">+これはbluetooth接続したU2Fデバイスが一定距離離れるもしくはUSB接続したデバイスをejectすることで端末からログアウトする，という仕様で再現できる.</span>
<span class="token inserted">+</span>
<span class="token inserted">+### monitoring U2F key by udev</span>
<span class="token inserted">+U2F Keyモニターをudevに任せることにする. まず対象のIDを特定する.</span>
<span class="token inserted">+`udevadm monitor`でudevのイベントをモニタリングした状態でU2F Keyを抜き差しすると `bind`, `remove` イベントが通知されるので， `$ID_MODEL_ID` 及び `$ID_VENDOR_ID` を取得する.</span>
<span class="token inserted">+</span>
<span class="token inserted">+ ```sh</span>
<span class="token inserted">+$ udevadm monitor --environment --udev</span>
<span class="token inserted">+</span>
<span class="token inserted">+UDEV  [28028.490650] bind     /devices/pci0000:00/0000:00:14.0/usb1/1-3 (usb)</span>
<span class="token inserted">+ACTION=bind</span>
<span class="token inserted">+BUSNUM=001</span>
<span class="token inserted">+DEVNAME=/dev/bus/usb/001/013</span>
<span class="token inserted">+DEVNUM=013</span>
<span class="token inserted">+DEVPATH=/devices/pci0000:00/0000:00:14.0/usb1/1-3</span>
<span class="token inserted">+DEVTYPE=usb_device</span>
<span class="token inserted">+DRIVER=usb</span>
<span class="token inserted">+ID_BUS=usb</span>
<span class="token inserted">+ID_MODEL=XXXXX</span>
<span class="token inserted">+ID_MODEL_ENC=XXXXX</span>
<span class="token inserted">+ID_MODEL_ID=f025</span>
<span class="token inserted">+ID_REVISION=0100</span>
<span class="token inserted">+ID_SERIAL=ExcelSecu_EsecuFIDO_HID</span>
<span class="token inserted">+ID_USB_INTERFACES=:030000:</span>
<span class="token inserted">+ID_VENDOR=ExcelSecu</span>
<span class="token inserted">+ID_VENDOR_ENC=ExcelSecu</span>
<span class="token inserted">+ID_VENDOR_ID=1ea8</span>
<span class="token inserted">+MAJOR=189</span>
<span class="token inserted">+MINOR=12</span>
<span class="token inserted">+PRODUCT=1ea8/f025/100</span>
<span class="token inserted">+SEQNUM=12938</span>
<span class="token inserted">+SUBSYSTEM=usb</span>
<span class="token inserted">+TYPE=0/0/0</span>
<span class="token inserted">+USEC_INITIALIZED=28027949334</span>
<span class="token inserted">+ ```</span>
<span class="token inserted">+</span>
<span class="token inserted">+上記の例では `ID_MODEL_ID=f025`，`ID_VENDOR_ID=1ea8` となっている.</span>
<span class="token inserted">+このIDペアを用いて，U2F Key解除時の`udev`ルールを作成する.</span>
<span class="token inserted">+</span>
<span class="token inserted">+**`/etc/udev/rules.d/xx-u2fkey.rules`** (xxは適当な数字)</span>
<span class="token inserted">+</span>
<span class="token inserted">+ ```config</span>
<span class="token inserted">+ACTION=="remove", ENV{ID_VENDOR_ID}=="1ea8", ENV{ID_MODEL_ID}=="f025", RUN+="/usr/local/bin/i3lock"</span>
<span class="token inserted">+ ```</span>
<span class="token inserted">+</span>
<span class="token inserted">+最後にrulesを登録し完了.</span>
<span class="token inserted">+</span>
<span class="token inserted">+ ```sh</span>
<span class="token inserted">+$ udevadm control --reload-rules</span>
<span class="token inserted">+$ service udev reload</span>
<span class="token inserted">+ ```</span>
<span class="token inserted">+</span>
<span class="token inserted">+---</span>
<span class="token inserted">+フリーランスという職業柄，PCを所持して企業へ出向くことが多くどうやってセキュリティ担保するかなーと考えてたところ`pamu2fcfg`を見かけたので試してみた.  </span>
<span class="token inserted">+Yubikeyを忘れて外出するという失態を犯した[^twi]ので既に運用が危ういがデータは守れてるのでよし(よくないが)</span>
<span class="token inserted">+</span>
<span class="token inserted">+</span>
<span class="token inserted">+## Reference</span>
<span class="token inserted">+[^pamu2fcfg]: [developers.yubico.com/pam-u2f/Manuals/pamu2fcfg.1.html](https://developers.yubico.com/pam-u2f/Manuals/pamu2fcfg.1.html)</span>
<span class="token inserted">+[^applewatch]: [support.apple.com/ja-jp/HT206995](https://support.apple.com/ja-jp/HT206995)</span>
<span class="token inserted">+[^twi]: [twitter.com/k_0ka/status/1159312312156561408](https://twitter.com/k_0ka/status/1159312312156561408)</span>
<span class="token inserted">+- [Enable FIDO U2F USB support](https://wiki.gentoo.org/wiki/Pam_u2f)</span>
<span class="token inserted">+- [support.yubico.com#enabling the Yubico PPA on Ubuntu](https://support.yubico.com/support/solutions/articles/15000010964-enabling-the-yubico-ppa-on-ubuntu)</span>
<span class="token inserted">+- [support.yubico.com#Ubuntu Linux Login Guide - U2F](https://support.yubico.com/support/solutions/articles/15000011356-ubuntu-linux-login-guide-u2f)</span>
</code></pre></div></p></details></div></div><aside class="slug_aside__1vC-U"><nav class="Toc_toc__nav__2o5GC" role="navigation"><ul class="Toc_toc__3i1gg"></ul></nav></aside></div></main><footer class="Footer_footer__cAlbN"><small>Code snippets licensed under MIT, unless otherwise noted.</small></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"2019-08-08-autolock-with-yubikey","title":"Linux: Login/sudo with Yubikey","categories":["diary"],"ogImage":"https://koka831.github.io/img/icon.png","tags":["Linux","udev","yubikey"],"content":"\u003ch2 id=\"abstract\"\u003e\u003ca href=\"#abstract\"\u003eAbstract\u003c/a\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eLinux Desktopのログイン時及び\u003ccode class=\"language-unknown\"\u003esudo\u003c/code\u003e時にYubikey + Passwordを必須にしてみた.\u003c/li\u003e\n\u003cli\u003eログインした状態でYubikeyを抜くとlockするようにした.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"env\"\u003e\u003ca href=\"#env\"\u003eEnv\u003c/a\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eUbuntu 18.04\u003c/li\u003e\n\u003cli\u003eFIDO U2F Security Key(自分は\u003ca href=\"https://www.amazon.co.jp/dp/B06XHTKFH3/ref=cm_sw_em_r_mt_dp_U_Ha5sDbS6H12P6\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003eこれ\u003c/a\u003eつかってます. 端子ガードついてるKey他にも出てほしい)\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"install-dependencies\"\u003e\u003ca href=\"#install-dependencies\"\u003eInstall Dependencies\u003c/a\u003e\u003c/h2\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre data-file=\"terminal\" class=\"language-shell-session\"\u003e\u003ccode class=\"language-shell-session\"\u003e\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003e\u003cspan class=\"token function\"\u003esudo\u003c/span\u003e add-apt-repository ppa:yubico/stable\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003e\u003cspan class=\"token function\"\u003esudo\u003c/span\u003e \u003cspan class=\"token function\"\u003eapt-get\u003c/span\u003e \u003cspan class=\"token function\"\u003einstall\u003c/span\u003e yubikey-manager-qt yubioath-desktop yubikey-personalization-gui\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"setup-u2f-key\"\u003e\u003ca href=\"#setup-u2f-key\"\u003eSetup U2F Key\u003c/a\u003e\u003c/h2\u003e\n\u003ch3 id=\"u2f-keyの登録\"\u003e\u003ca href=\"#u2f-key%E3%81%AE%E7%99%BB%E9%8C%B2\"\u003eU2F Keyの登録\u003c/a\u003e\u003c/h3\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre data-file=\"terminal\" class=\"language-shell-session\"\u003e\u003ccode class=\"language-shell-session\"\u003e\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003e\u003cspan class=\"token function\"\u003emkdir\u003c/span\u003e -p \u003cspan class=\"token environment constant\"\u003e$HOME\u003c/span\u003e/.config/Yubico\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003epamu2fcfg -u\u003cspan class=\"token variable\"\u003e${\u003cspan class=\"token environment constant\"\u003eUSER\u003c/span\u003e}\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token environment constant\"\u003e$HOME\u003c/span\u003e/.config/Yubico/u2f_keys\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eまたバックアップデバイスを追加する場合には\u003ccode class=\"language-unknown\"\u003e--nouser\u003c/code\u003eをつけて追記\u003csup id=\"fnref-pamu2fcfg\"\u003e\u003ca href=\"#fn-pamu2fcfg\" class=\"footnote-ref\"\u003epamu2fcfg\u003c/a\u003e\u003c/sup\u003e.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre data-file=\"terminal\" class=\"language-shell-session\"\u003e\u003ccode class=\"language-shell-session\"\u003e\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003epamu2fcfg -n \u003cspan class=\"token operator\"\u003e\u003e\u003e\u003c/span\u003e \u003cspan class=\"token environment constant\"\u003e$HOME\u003c/span\u003e/.config/Yubico/u2f_keys\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3 id=\"u2f-for-sudo\"\u003e\u003ca href=\"#u2f-for-sudo\"\u003eU2F for SUDO\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e以下の6行目を追記. PAM(Pluggable Authentication Modules)での認証において，password入力後にYubikeyがrequireされるようになる(Yubikeyが無いとauthできない).\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode class=\"language-unknown\"\u003e/etc/pam.d/sudo\u003c/code\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre data-file=\"/etc/pam.d/sudo\" class=\"language-diff\"\u003e\u003ccode class=\"language-diff\"\u003e\u003cspan class=\"token unchanged\"\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e#%PAM-1.0\n\u003c/span\u003e\n\u003cspan class=\"token unchanged\"\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003esession    required    pam_env.so readenv=1 user_readenv=0\n\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003esession    required    pam_env.so readenv=1 envfile=/etc/default/locale user_readenv=0\n\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e@include   common-auth\n\u003c/span\u003e\u003cspan class=\"token inserted-sign inserted\"\u003e\u003cspan class=\"token prefix inserted\"\u003e+\u003c/span\u003eauth       required    pam_u2f.so\n\u003c/span\u003e\u003cspan class=\"token unchanged\"\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e@include   common-account\n\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e@include   common-session-noninteractive\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3 id=\"u2f-for-login\"\u003e\u003ca href=\"#u2f-for-login\"\u003eU2F for Login\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eDisplay ManagerにGDM(Gnome Display Manager)を用いている場合は以下のファイルに\u003ccode class=\"language-unknown\"\u003epam_u2f.so\u003c/code\u003eの行を追記する.\u003cbr\u003e\n\u003cstrong\u003e\u003ccode class=\"language-unknown\"\u003e/etc/pam.d/gdm-password\u003c/code\u003e\u003c/strong\u003e\nその他のDMを用いている場合(KDE等)は \u003cstrong\u003e\u003ccode class=\"language-unknown\"\u003e/etc/pam.d/lightdm\u003c/code\u003e\u003c/strong\u003e に追記する.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre data-file=\"/etc/pam.d/gdm-password\" class=\"language-diff\"\u003e\u003ccode class=\"language-diff\"\u003e\u003cspan class=\"token unchanged\"\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e#%PAM-1.0\n\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003eauth     requisite       pam_nologin.so\n\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003eauth     required        pam_succeed_if.so user != root quiet_success\n\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e@include common-auth\n\u003c/span\u003e\u003cspan class=\"token inserted-sign inserted\"\u003e\u003cspan class=\"token prefix inserted\"\u003e+\u003c/span\u003eauth     required        pam_u2f.so\n\u003c/span\u003e\u003cspan class=\"token unchanged\"\u003e\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003eauth     optional        pam_gnome_keyring.so\n\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e@include common-account\n\u003cspan class=\"token prefix unchanged\"\u003e \u003c/span\u003e...omit\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"auto-lock-without-u2f\"\u003e\u003ca href=\"#auto-lock-without-u2f\"\u003eAuto-lock without U2F\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eここからが本題. U2F Keyの接続が解除されると端末をロックする.\u003c/p\u003e\n\u003cp\u003eもともと自分の使っているLaptopには指紋認証センサが付属している．一般に生体認証はU2Fよりもセキュアであるし，自分も異論はない.\u003cbr\u003e\nではU2Fが生体認証より優れている点はなにか. 自分の答えは認証の持続性をコントロールできる点である.\u003c/p\u003e\n\u003cp\u003e指紋認証を例に取ると，一度ログインした端末は一定時間操作をしない際のオートロックまたはユーザ自身の能動的なログアウトをしない限り，認証を再度必要としない.\u003cbr\u003e\n対してU2Fでは\u003cstrong\u003eデバイスが接続されている間だけ認証されている\u003c/strong\u003eという状態をもたらすことができる.\u003c/p\u003e\n\u003cp\u003eApple Watchを身に着けた状態でMacの自動ログインが可能\u003csup id=\"fnref-applewatch\"\u003e\u003ca href=\"#fn-applewatch\" class=\"footnote-ref\"\u003eapplewatch\u003c/a\u003e\u003c/sup\u003eという例がある.\nこれはbluetooth接続したU2Fデバイスが一定距離離れるもしくはUSB接続したデバイスをejectすることで端末からログアウトする，という仕様で再現できる.\u003c/p\u003e\n\u003ch3 id=\"monitoring-u2f-key-by-udev\"\u003e\u003ca href=\"#monitoring-u2f-key-by-udev\"\u003emonitoring U2F key by udev\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eU2F Keyモニターをudevに任せることにする. まず対象のIDを特定する.\n\u003ccode class=\"language-unknown\"\u003eudevadm monitor\u003c/code\u003eでudevのイベントをモニタリングした状態でU2F Keyを抜き差しすると \u003ccode class=\"language-unknown\"\u003ebind\u003c/code\u003e, \u003ccode class=\"language-unknown\"\u003eremove\u003c/code\u003e イベントが通知されるので， \u003ccode class=\"language-unknown\"\u003e$ID_MODEL_ID\u003c/code\u003e 及び \u003ccode class=\"language-unknown\"\u003e$ID_VENDOR_ID\u003c/code\u003e を取得する.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre data-file=\"terminal\" class=\"language-shell-session\"\u003e\u003ccode class=\"language-shell-session\"\u003e\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003eudevadm monitor --environment --udev\u003c/span\u003e\u003c/span\u003e\n\n\u003cspan class=\"token output\"\u003eUDEV  [28028.490650] bind     /devices/pci0000:00/0000:00:14.0/usb1/1-3 (usb)\u003c/span\u003e\n\u003cspan class=\"token output\"\u003eACTION=bind\u003c/span\u003e\n\u003cspan class=\"token output\"\u003eBUSNUM=001\u003c/span\u003e\n\u003cspan class=\"token output\"\u003eDEVNAME=/dev/bus/usb/001/013\u003c/span\u003e\n\u003cspan class=\"token output\"\u003eDEVNUM=013\u003c/span\u003e\n\u003cspan class=\"token output\"\u003eDEVPATH=/devices/pci0000:00/0000:00:14.0/usb1/1-3\u003c/span\u003e\n\u003cspan class=\"token output\"\u003eDEVTYPE=usb_device\u003c/span\u003e\n\u003cspan class=\"token output\"\u003eDRIVER=usb\u003c/span\u003e\n\u003cspan class=\"token output\"\u003eID_BUS=usb\u003c/span\u003e\n\u003cspan class=\"token output\"\u003eID_MODEL=XXXXX\u003c/span\u003e\n\u003cspan class=\"token output\"\u003eID_MODEL_ENC=XXXXX\u003c/span\u003e\n\u003cspan class=\"token output\"\u003eID_MODEL_ID=f025\u003c/span\u003e\n\u003cspan class=\"token output\"\u003eID_REVISION=0100\u003c/span\u003e\n\u003cspan class=\"token output\"\u003eID_SERIAL=ExcelSecu_EsecuFIDO_HID\u003c/span\u003e\n\u003cspan class=\"token output\"\u003eID_USB_INTERFACES=:030000:\u003c/span\u003e\n\u003cspan class=\"token output\"\u003eID_VENDOR=ExcelSecu\u003c/span\u003e\n\u003cspan class=\"token output\"\u003eID_VENDOR_ENC=ExcelSecu\u003c/span\u003e\n\u003cspan class=\"token output\"\u003eID_VENDOR_ID=1ea8\u003c/span\u003e\n\u003cspan class=\"token output\"\u003eMAJOR=189\u003c/span\u003e\n\u003cspan class=\"token output\"\u003eMINOR=12\u003c/span\u003e\n\u003cspan class=\"token output\"\u003ePRODUCT=1ea8/f025/100\u003c/span\u003e\n\u003cspan class=\"token output\"\u003eSEQNUM=12938\u003c/span\u003e\n\u003cspan class=\"token output\"\u003eSUBSYSTEM=usb\u003c/span\u003e\n\u003cspan class=\"token output\"\u003eTYPE=0/0/0\u003c/span\u003e\n\u003cspan class=\"token output\"\u003eUSEC_INITIALIZED=28027949334\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e上記の例では \u003ccode class=\"language-unknown\"\u003eID_MODEL_ID=f025\u003c/code\u003e，\u003ccode class=\"language-unknown\"\u003eID_VENDOR_ID=1ea8\u003c/code\u003e となっている.\nこのIDペアを用いて，U2F Key解除時の\u003ccode class=\"language-unknown\"\u003eudev\u003c/code\u003eルールを作成する.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode class=\"language-unknown\"\u003e/etc/udev/rules.d/xx-u2fkey.rules\u003c/code\u003e\u003c/strong\u003e (xxは適当な数字)\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre data-file=\"/etc/udev/rules.d/xx-u2fkey.rules\" class=\"language-config\"\u003e\u003ccode class=\"language-config\"\u003eACTION==\u0026#x26;quot;remove\u0026#x26;quot;, ENV{ID_VENDOR_ID}==\u0026#x26;quot;1ea8\u0026#x26;quot;, ENV{ID_MODEL_ID}==\u0026#x26;quot;f025\u0026#x26;quot;, RUN+=\u0026#x26;quot;/usr/local/bin/i3lock\u0026#x26;quot;\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e最後にrulesを登録し完了.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre data-file=\"terminal\" class=\"language-shell-session\"\u003e\u003ccode class=\"language-shell-session\"\u003e\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003eudevadm control --reload-rules\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003e\u003cspan class=\"token function\"\u003eservice\u003c/span\u003e udev reload\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003chr\u003e\n\u003cp\u003eフリーランスという職業柄，PCを所持して企業へ出向くことが多くどうやってセキュリティ担保するかなーと考えてたところ\u003ccode class=\"language-unknown\"\u003epamu2fcfg\u003c/code\u003eを見かけたので試してみた.\u003cbr\u003e\nYubikeyを忘れて外出するという失態を犯した\u003csup id=\"fnref-twi\"\u003e\u003ca href=\"#fn-twi\" class=\"footnote-ref\"\u003etwi\u003c/a\u003e\u003c/sup\u003eので既に運用が危ういがデータは守れてるのでよし(よくないが)\u003c/p\u003e\n\u003ch2 id=\"reference\"\u003e\u003ca href=\"#reference\"\u003eReference\u003c/a\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://wiki.gentoo.org/wiki/Pam_u2f\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003eEnable FIDO U2F USB support\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://support.yubico.com/support/solutions/articles/15000010964-enabling-the-yubico-ppa-on-ubuntu\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003esupport.yubico.com#enabling the Yubico PPA on Ubuntu\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://support.yubico.com/support/solutions/articles/15000011356-ubuntu-linux-login-guide-u2f\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003esupport.yubico.com#Ubuntu Linux Login Guide - U2F\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"footnotes\"\u003e\n\u003chr\u003e\n\u003col\u003e\n\u003cli id=\"fn-pamu2fcfg\"\u003e\u003ca href=\"https://developers.yubico.com/pam-u2f/Manuals/pamu2fcfg.1.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003edevelopers.yubico.com/pam-u2f/Manuals/pamu2fcfg.1.html\u003c/a\u003e\u003ca href=\"#fnref-pamu2fcfg\" class=\"footnote-backref\"\u003e↩\u003c/a\u003e\u003c/li\u003e\n\u003cli id=\"fn-applewatch\"\u003e\u003ca href=\"https://support.apple.com/ja-jp/HT206995\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003esupport.apple.com/ja-jp/HT206995\u003c/a\u003e\u003ca href=\"#fnref-applewatch\" class=\"footnote-backref\"\u003e↩\u003c/a\u003e\u003c/li\u003e\n\u003cli id=\"fn-twi\"\u003e\u003ca href=\"https://twitter.com/k_0ka/status/1159312312156561408\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003etwitter.com/k_0ka/status/1159312312156561408\u003c/a\u003e\u003ca href=\"#fnref-twi\" class=\"footnote-backref\"\u003e↩\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/div\u003e","description":"Yubikeyを自宅に忘れて１敗","commits":[{"title":"update","date":"  Sat Apr 10 17:49:51 2021","hash":"7fc1fe90","diff":"\u003cdiv class=\"remark-highlight\"\u003e\u003cpre data-file=\"7fc1fe90.patch\" class=\"language-git  language-diff\"\u003e\u003ccode class=\"language-git\"\u003e\u003cspan class=\"token commit-sha1\"\u003ecommit 7fc1fe9095a4a16d5b29f42b7ce90933aa17d91e\u003c/span\u003e\nAuthor: koka \u0026#x3C;\u003ca href=\"mailto:koka.code@gmail.com\" class=\"token email-link\"\u003ekoka.code@gmail.com\u003c/a\u003e\u003e\nDate:   Sat Apr 10 17:49:51 2021 +0900\n\n  update\n\ndiff --git a/_posts/2019-08-08-autolock-with-yubikey.md b/_posts/2019-08-08-autolock-with-yubikey.md\nindex f40e591..e3bfc43 100644\n\u003cspan class=\"token deleted\"\u003e--- a/_posts/2019-08-08-autolock-with-yubikey.md\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+++ b/_posts/2019-08-08-autolock-with-yubikey.md\u003c/span\u003e\n@@ -20,7 +20,7 @@ description: Yubikeyを自宅に忘れて１敗\n\n\u003cspan class=\"token comment\"\u003e## Install Dependencies\u003c/span\u003e\n\n\u003cspan class=\"token deleted\"\u003e- ```sh\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ ```shell-session[data-file=\"terminal\"]\u003c/span\u003e\n$ sudo add-apt-repository ppa:yubico/stable\n$ sudo apt-get install yubikey-manager-qt yubioath-desktop yubikey-personalization-gui\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e@@ -28,14 +28,14 @@ $ sudo apt-get install yubikey-manager-qt yubioath-desktop yubikey-personalizati\u003c/p\u003e\n\u003ch2 id=\"setup-u2f-key\"\u003e\u003ca href=\"#setup-u2f-key\"\u003eSetup U2F Key\u003c/a\u003e\u003c/h2\u003e\n\u003ch3 id=\"u2f-keyの登録\"\u003e\u003ca href=\"#u2f-key%E3%81%AE%E7%99%BB%E9%8C%B2\"\u003eU2F Keyの登録\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-sh\"\u003e\u003ccode class=\"language-sh\"\u003eundefined\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre data-file=\"terminal\" class=\"language-shell-session\"\u003e\u003ccode class=\"language-shell-session\"\u003e\u003cspan class=\"command-line-prompt\"\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003em\u003c/mi\u003e\u003cmi\u003ek\u003c/mi\u003e\u003cmi\u003ed\u003c/mi\u003e\u003cmi\u003ei\u003c/mi\u003e\u003cmi\u003er\u003c/mi\u003e\u003cmo\u003e−\u003c/mo\u003e\u003cmi\u003ep\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003emkdir -p\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.77777em;vertical-align:-0.08333em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003em\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\"\u003ek\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ed\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ei\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\"\u003er\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e−\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ep\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003eHOME/.config/Yubico\n\u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ep\u003c/mi\u003e\u003cmi\u003ea\u003c/mi\u003e\u003cmi\u003em\u003c/mi\u003e\u003cmi\u003eu\u003c/mi\u003e\u003cmn\u003e2\u003c/mn\u003e\u003cmi\u003ef\u003c/mi\u003e\u003cmi\u003ec\u003c/mi\u003e\u003cmi\u003ef\u003c/mi\u003e\u003cmi\u003eg\u003c/mi\u003e\u003cmo\u003e−\u003c/mo\u003e\u003cmi\u003eu\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e pamu2fcfg -u\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ep\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ea\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003em\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eu\u003c/span\u003e\u003cspan class=\"mord\"\u003e2\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\"\u003ef\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ec\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\"\u003ef\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.03588em;\"\u003eg\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e−\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eu\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e{USER} \u003e $HOME/.config/Yubico/u2f_keys\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-unknown\"\u003e\u003ccode class=\"language-unknown\"\u003e\nまたバックアップデバイスを追加する場合には`--nouser`をつけて追記[^pamu2fcfg].\n\n- ```sh\n+ ```shell-session[data-file=\u0026#x26;quot;terminal\u0026#x26;quot;]\n$ pamu2fcfg -n \u0026#x26;gt;\u0026#x26;gt; $HOME/.config/Yubico/u2f_keys\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e@@ -44,7 +44,7 @@ \u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ep\u003c/mi\u003e\u003cmi\u003ea\u003c/mi\u003e\u003cmi\u003em\u003c/mi\u003e\u003cmi\u003eu\u003c/mi\u003e\u003cmn\u003e2\u003c/mn\u003e\u003cmi\u003ef\u003c/mi\u003e\u003cmi\u003ec\u003c/mi\u003e\u003cmi\u003ef\u003c/mi\u003e\u003cmi\u003eg\u003c/mi\u003e\u003cmo\u003e−\u003c/mo\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo\u003e\u003e\u003c/mo\u003e\u003cmo\u003e\u003e\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003epamu2fcfg -n \u003e\u003e\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ep\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ea\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003em\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eu\u003c/span\u003e\u003cspan class=\"mord\"\u003e2\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\"\u003ef\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ec\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\"\u003ef\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.03588em;\"\u003eg\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e−\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003en\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003eHOME/.config/Yubico/u2f_keys\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode class=\"language-unknown\"\u003e/etc/pam.d/sudo\u003c/code\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-diff\"\u003e\u003ccode class=\"language-diff\"\u003e\u003cspan class=\"command-line-prompt\"\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre data-file=\"/etc/pam.d/sudo\" class=\"language-diff\"\u003e\u003ccode class=\"language-diff\"\u003e#%PAM-1.0\n\nsession    required    pam_env.so readenv=1 user_readenv=0\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e@@ -61,7 +61,7 @@ Display ManagerにGDM(Gnome Display Manager)を用いている場合は以下の\nその他のDMを用いている場合(KDE等)は \u003cstrong\u003e\u003ccode class=\"language-unknown\"\u003e/etc/pam.d/lightdm\u003c/code\u003e\u003c/strong\u003e に追記する.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-diff\"\u003e\u003ccode class=\"language-diff\"\u003e\u003cspan class=\"command-line-prompt\"\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre data-file=\"/etc/pam.d/gdm-password\" class=\"language-diff\"\u003e\u003ccode class=\"language-diff\"\u003e#%PAM-1.0\nauth     requisite       pam_nologin.so\nauth     required        pam_succeed_if.so user != root quiet_success\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e@@ -88,7 +88,7 @@ Apple Watchを身に着けた状態でMacの自動ログインが可能[^applewa\nU2F Keyモニターをudevに任せることにする. まず対象のIDを特定する.\n\u003ccode class=\"language-unknown\"\u003eudevadm monitor\u003c/code\u003eでudevのイベントをモニタリングした状態でU2F Keyを抜き差しすると \u003ccode class=\"language-unknown\"\u003ebind\u003c/code\u003e, \u003ccode class=\"language-unknown\"\u003eremove\u003c/code\u003e イベントが通知されるので， \u003ccode class=\"language-unknown\"\u003e$ID_MODEL_ID\u003c/code\u003e 及び \u003ccode class=\"language-unknown\"\u003e$ID_VENDOR_ID\u003c/code\u003e を取得する.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-sh\"\u003e\u003ccode class=\"language-sh\"\u003eundefined\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre data-file=\"terminal\" class=\"language-shell-session\"\u003e\u003ccode class=\"language-shell-session\"\u003e\u003cspan class=\"command-line-prompt\"\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e$ udevadm monitor --environment --udev\u003c/p\u003e\n\u003cp\u003eUDEV  [28028.490650] bind     /devices/pci0000:00/0000:00:14.0/usb1/1-3 (usb)\n@@ -123,13 +123,13 @@ USEC_INITIALIZED=28027949334\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode class=\"language-unknown\"\u003e/etc/udev/rules.d/xx-u2fkey.rules\u003c/code\u003e\u003c/strong\u003e (xxは適当な数字)\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-config\"\u003e\u003ccode class=\"language-config\"\u003eundefined\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre data-file=\"/etc/udev/rules.d/xx-u2fkey.rules\" class=\"language-config\"\u003e\u003ccode class=\"language-config\"\u003eundefined\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eACTION==\"remove\", ENV{ID_VENDOR_ID}==\"1ea8\", ENV{ID_MODEL_ID}==\"f025\", RUN+=\"/usr/local/bin/i3lock\"\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-unknown\"\u003e\u003ccode class=\"language-unknown\"\u003e\n最後にrulesを登録し完了.\n\n- ```sh\n+ ```shell-session[data-file=\u0026#x26;quot;terminal\u0026#x26;quot;]\n$ udevadm control --reload-rules\n$ service udev reload\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-unknown\"\u003e\u003ccode class=\"language-unknown\"\u003eundefined\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e"},{"title":"copy md","date":"  Sat Jan 30 22:18:17 2021","hash":"35b550ae","diff":"\u003cdiv class=\"remark-highlight\"\u003e\u003cpre data-file=\"35b550ae.patch\" class=\"language-git  language-diff\"\u003e\u003ccode class=\"language-git\"\u003e\u003cspan class=\"token commit-sha1\"\u003ecommit 35b550ae83af4efaeadf33471c8ca8a32c1079c8\u003c/span\u003e\nAuthor: koka \u0026#x3C;\u003ca href=\"mailto:koka.code@gmail.com\" class=\"token email-link\"\u003ekoka.code@gmail.com\u003c/a\u003e\u003e\nDate:   Sat Jan 30 22:18:17 2021 +0900\n\n  copy md\n\ndiff --git a/_posts/2019-08-08-autolock-with-yubikey.md b/_posts/2019-08-08-autolock-with-yubikey.md\nnew file mode 100644\nindex 0000000..f40e591\n\u003cspan class=\"token deleted\"\u003e--- /dev/null\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+++ b/_posts/2019-08-08-autolock-with-yubikey.md\u003c/span\u003e\n\u003cspan class=\"token coord\"\u003e@@ -0,0 +1,148 @@\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+---\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+title: 'Linux: Login/sudo with Yubikey'\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+date: 2019-08-08\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+categories:\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+- diary\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+tags:\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+- Linux\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+- udev\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+- yubikey\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+description: Yubikeyを自宅に忘れて１敗\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+---\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+## Abstract\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+- Linux Desktopのログイン時及び`sudo`時にYubikey + Passwordを必須にしてみた.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+- ログインした状態でYubikeyを抜くとlockするようにした.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+## Env\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+- Ubuntu 18.04\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+- FIDO U2F Security Key(自分は[これ](https://www.amazon.co.jp/dp/B06XHTKFH3/ref=cm_sw_em_r_mt_dp_U_Ha5sDbS6H12P6)つかってます. 端子ガードついてるKey他にも出てほしい)\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+## Install Dependencies\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ ```sh\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ sudo add-apt-repository ppa:yubico/stable\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ sudo apt-get install yubikey-manager-qt yubioath-desktop yubikey-personalization-gui\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ ```\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+## Setup U2F Key\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### U2F Keyの登録\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ ```sh\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ mkdir -p $HOME/.config/Yubico\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ pamu2fcfg -u${USER} \u003e $HOME/.config/Yubico/u2f_keys\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ ```\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+またバックアップデバイスを追加する場合には`--nouser`をつけて追記[^pamu2fcfg].\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ ```sh\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ pamu2fcfg -n \u003e\u003e $HOME/.config/Yubico/u2f_keys\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ ```\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### U2F for SUDO\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+以下の6行目を追記. PAM(Pluggable Authentication Modules)での認証において，password入力後にYubikeyがrequireされるようになる(Yubikeyが無いとauthできない).\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+**`/etc/pam.d/sudo`**\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ ```diff\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ #%PAM-1.0\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ session    required    pam_env.so readenv=1 user_readenv=0\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ session    required    pam_env.so readenv=1 envfile=/etc/default/locale user_readenv=0\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ @include   common-auth\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e++auth       required    pam_u2f.so\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ @include   common-account\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ @include   common-session-noninteractive\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ ```\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### U2F for Login\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+Display ManagerにGDM(Gnome Display Manager)を用いている場合は以下のファイルに`pam_u2f.so`の行を追記する.  \u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+**`/etc/pam.d/gdm-password`**\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+その他のDMを用いている場合(KDE等)は **`/etc/pam.d/lightdm`** に追記する.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ ```diff\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ #%PAM-1.0\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ auth     requisite       pam_nologin.so\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ auth     required        pam_succeed_if.so user != root quiet_success\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ @include common-auth\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e++auth     required        pam_u2f.so\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ auth     optional        pam_gnome_keyring.so\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ @include common-account\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ ...omit\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ ```\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+## Auto-lock without U2F\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ここからが本題. U2F Keyの接続が解除されると端末をロックする.  \u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+もともと自分の使っているLaptopには指紋認証センサが付属している．一般に生体認証はU2Fよりもセキュアであるし，自分も異論はない.  \u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ではU2Fが生体認証より優れている点はなにか. 自分の答えは認証の持続性をコントロールできる点である.  \u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+指紋認証を例に取ると，一度ログインした端末は一定時間操作をしない際のオートロックまたはユーザ自身の能動的なログアウトをしない限り，認証を再度必要としない.  \u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+対してU2Fでは**デバイスが接続されている間だけ認証されている**という状態をもたらすことができる.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+Apple Watchを身に着けた状態でMacの自動ログインが可能[^applewatch]という例がある.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+これはbluetooth接続したU2Fデバイスが一定距離離れるもしくはUSB接続したデバイスをejectすることで端末からログアウトする，という仕様で再現できる.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### monitoring U2F key by udev\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+U2F Keyモニターをudevに任せることにする. まず対象のIDを特定する.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+`udevadm monitor`でudevのイベントをモニタリングした状態でU2F Keyを抜き差しすると `bind`, `remove` イベントが通知されるので， `$ID_MODEL_ID` 及び `$ID_VENDOR_ID` を取得する.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ ```sh\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ udevadm monitor --environment --udev\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+UDEV  [28028.490650] bind     /devices/pci0000:00/0000:00:14.0/usb1/1-3 (usb)\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ACTION=bind\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+BUSNUM=001\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+DEVNAME=/dev/bus/usb/001/013\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+DEVNUM=013\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+DEVPATH=/devices/pci0000:00/0000:00:14.0/usb1/1-3\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+DEVTYPE=usb_device\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+DRIVER=usb\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ID_BUS=usb\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ID_MODEL=XXXXX\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ID_MODEL_ENC=XXXXX\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ID_MODEL_ID=f025\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ID_REVISION=0100\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ID_SERIAL=ExcelSecu_EsecuFIDO_HID\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ID_USB_INTERFACES=:030000:\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ID_VENDOR=ExcelSecu\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ID_VENDOR_ENC=ExcelSecu\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ID_VENDOR_ID=1ea8\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+MAJOR=189\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+MINOR=12\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+PRODUCT=1ea8/f025/100\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+SEQNUM=12938\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+SUBSYSTEM=usb\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+TYPE=0/0/0\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+USEC_INITIALIZED=28027949334\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ ```\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+上記の例では `ID_MODEL_ID=f025`，`ID_VENDOR_ID=1ea8` となっている.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+このIDペアを用いて，U2F Key解除時の`udev`ルールを作成する.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+**`/etc/udev/rules.d/xx-u2fkey.rules`** (xxは適当な数字)\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ ```config\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ACTION==\"remove\", ENV{ID_VENDOR_ID}==\"1ea8\", ENV{ID_MODEL_ID}==\"f025\", RUN+=\"/usr/local/bin/i3lock\"\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ ```\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+最後にrulesを登録し完了.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ ```sh\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ udevadm control --reload-rules\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ service udev reload\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ ```\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+---\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+フリーランスという職業柄，PCを所持して企業へ出向くことが多くどうやってセキュリティ担保するかなーと考えてたところ`pamu2fcfg`を見かけたので試してみた.  \u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+Yubikeyを忘れて外出するという失態を犯した[^twi]ので既に運用が危ういがデータは守れてるのでよし(よくないが)\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+## Reference\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+[^pamu2fcfg]: [developers.yubico.com/pam-u2f/Manuals/pamu2fcfg.1.html](https://developers.yubico.com/pam-u2f/Manuals/pamu2fcfg.1.html)\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+[^applewatch]: [support.apple.com/ja-jp/HT206995](https://support.apple.com/ja-jp/HT206995)\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+[^twi]: [twitter.com/k_0ka/status/1159312312156561408](https://twitter.com/k_0ka/status/1159312312156561408)\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+- [Enable FIDO U2F USB support](https://wiki.gentoo.org/wiki/Pam_u2f)\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+- [support.yubico.com#enabling the Yubico PPA on Ubuntu](https://support.yubico.com/support/solutions/articles/15000010964-enabling-the-yubico-ppa-on-ubuntu)\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+- [support.yubico.com#Ubuntu Linux Login Guide - U2F](https://support.yubico.com/support/solutions/articles/15000011356-ubuntu-linux-login-guide-u2f)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e"}],"publishedAt":"Thu Aug 08 2019","updatedAt":"Sat Apr 10 2021"}},"__N_SSG":true},"page":"/archives/[slug]","query":{"slug":"2019-08-08-autolock-with-yubikey"},"buildId":"Hnq9okBr3mhJlK_oHmk2t","assetPrefix":"/blog","isFallback":false,"gsp":true}</script><script nomodule="" src="/blog/_next/static/chunks/polyfills-8683bd742a84c1edd48c.js"></script><script src="/blog/_next/static/chunks/webpack-db5e9e5b812b68fa5741.js" async=""></script><script src="/blog/_next/static/chunks/framework-fa084fb9440caadd7405.js" async=""></script><script src="/blog/_next/static/chunks/commons-42870b5cbd0a37235f4f.js" async=""></script><script src="/blog/_next/static/chunks/main-6f040fcbb9831e40a9fd.js" async=""></script><script src="/blog/_next/static/chunks/pages/_app-5f44d4623abad7e89937.js" async=""></script><script src="/blog/_next/static/chunks/148-666076dd1d6135e3d14f.js" async=""></script><script src="/blog/_next/static/chunks/pages/archives/%5Bslug%5D-88d5fadb35297e43b6c3.js" async=""></script><script src="/blog/_next/static/Hnq9okBr3mhJlK_oHmk2t/_buildManifest.js" async=""></script><script src="/blog/_next/static/Hnq9okBr3mhJlK_oHmk2t/_ssgManifest.js" async=""></script></body></html>