<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta name="theme-color" content="#ddd4bb"/><meta property="og:type" content="website"/><meta property="og:url" content="https://koka831.github.io"/><meta property="og:site_name" content="/var/log/koka"/><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="/var/log/koka"/><meta name="twitter:site" content="@k_0ka"/><meta name="twitter:description" content="cat /var/log/koka &gt; /dev/null"/><link rel="alternate" type="application/rss+xml" href="https://koka831.github.io/feed.xml" title="/var/log/koka RSS2.0"/><title>clippyの開発でもrust-analyzerを使いたい | /var/log/koka</title><meta property="title" content="clippyの開発でもrust-analyzerを使いたい | /var/log/koka"/><meta property="og:title" content="clippyの開発でもrust-analyzerを使いたい | /var/log/koka"/><meta property="twitter:title" content="clippyの開発でもrust-analyzerを使いたい | /var/log/koka"/><meta property="description" content="rust-tools.nvim(nvim-lspconfig)でrust-clippyの開発時にrust-analyzerの補完を有効化するための設定方法"/><meta property="og:description" content="rust-tools.nvim(nvim-lspconfig)でrust-clippyの開発時にrust-analyzerの補完を有効化するための設定方法"/><meta property="twitter:description" content="rust-tools.nvim(nvim-lspconfig)でrust-clippyの開発時にrust-analyzerの補完を有効化するための設定方法"/><meta property="og:image" content="https://koka831.github.io/img/icon.png"/><meta name="next-head-count" content="19"/><link rel="preload" href="/_next/static/css/55d5df5355c8116d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/55d5df5355c8116d.css" data-n-g=""/><link rel="preload" href="/_next/static/css/91a87cd7c252ab33.css" as="style"/><link rel="stylesheet" href="/_next/static/css/91a87cd7c252ab33.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-9b312e20a4e32339.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-a054bbf31fb90f6a.js" defer=""></script><script src="/_next/static/chunks/pages/_app-e0fcf5a3a528e4c5.js" defer=""></script><script src="/_next/static/chunks/cb1608f2-ecfb8d9b659208e2.js" defer=""></script><script src="/_next/static/chunks/956-add503b49f004141.js" defer=""></script><script src="/_next/static/chunks/291-6b2ab5605142007f.js" defer=""></script><script src="/_next/static/chunks/pages/archives/%5Bslug%5D-f3c25ca7c16881be.js" defer=""></script><script src="/_next/static/znmYoLexqSmMsB-BwArHq/_buildManifest.js" defer=""></script><script src="/_next/static/znmYoLexqSmMsB-BwArHq/_ssgManifest.js" defer=""></script><script src="/_next/static/znmYoLexqSmMsB-BwArHq/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><nav class="Header_navigation__container__Xjar7"><div class="Header_navigation__qZpeO"><a href="/">/var/log/koka</a></div><div><a href="/archives">archive</a></div></nav><main class="Layout_container__LBFOo"><div class="slug_container__f_fjw"><div class="slug_main__WMOpC"><article class="slug_article__cOl2p" role="article"><div itemscope="" class="ArticleHeader_header__container__5Gs_X"><a class="ArticleHeader_post__title__gVFje" href="/archives/2022_10_30_rust-tools-for-clippy">clippyの開発でもrust-analyzerを使いたい</a><p>rust-tools.nvim(nvim-lspconfig)でrust-clippyの開発時にrust-analyzerの補完を有効化するための設定方法</p><div class="ArticleHeader_flex__yDiMS"><div class="ArticleHeader_post__tags__uCQyx"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="tags" class="svg-inline--fa fa-tags ArticleHeader_tags__icon__U9c_O" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M472.8 168.4C525.1 221.4 525.1 306.6 472.8 359.6L360.8 472.9C351.5 482.3 336.3 482.4 326.9 473.1C317.4 463.8 317.4 448.6 326.7 439.1L438.6 325.9C472.5 291.6 472.5 236.4 438.6 202.1L310.9 72.87C301.5 63.44 301.6 48.25 311.1 38.93C320.5 29.61 335.7 29.7 344.1 39.13L472.8 168.4zM.0003 229.5V80C.0003 53.49 21.49 32 48 32H197.5C214.5 32 230.7 38.74 242.7 50.75L410.7 218.7C435.7 243.7 435.7 284.3 410.7 309.3L277.3 442.7C252.3 467.7 211.7 467.7 186.7 442.7L18.75 274.7C6.743 262.7 0 246.5 0 229.5L.0003 229.5zM112 112C94.33 112 80 126.3 80 144C80 161.7 94.33 176 112 176C129.7 176 144 161.7 144 144C144 126.3 129.7 112 112 112z"></path></svg><p class="Tag_tag__rl8WL">Rust</p></div><div class="ArticleHeader_post__dates__6uEwt"><time dateTime="2022-10-30" itemProp="datePublished" class="PublishDate_post__date__jhH_w">published: <!-- -->2022-10-30</time><time dateTime="2022-10-30" itemProp="datePublished" class="PublishDate_post__date__jhH_w"></time></div></div></div><div class="slug_article__body__m2pRS"><p><a href="https://github.com/rust-lang/rust-clippy" target="_blank" rel="nofollow noopener noreferrer">rust-clippy</a>はrustcのAPIを利用しており、<code>clippy</code>のソースコードを編集する際、デフォルトでは<a href="https://rust-analyzer.github.io/" target="_blank" rel="nofollow noopener noreferrer">rust-analyzer</a>の補完が効かない.
そのため<code>rust-analyzer</code>に対し以下の設定が必要.</p>
<div class="remark-highlight"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span> <span class="token property">"rust-analyzer.rustc.source"</span><span class="token operator">:</span> <span class="token string">"discover"</span> <span class="token punctuation">}</span>
</code></pre></div>
<p>これを<a href="https://github.com/simrat39/rust-tools.nvim" target="_blank" rel="nofollow noopener noreferrer">rust-tools.nvim</a>で設定する方法が若干わかりづらかったのでメモ.</p>
<h2 id="tldr"><a href="#tldr">TL;DR</a></h2>
<p>結論、以下の様に<code>server</code>に対し<code>settings.["rust-analyzer"]</code>を渡す.</p>
<div class="remark-highlight"><pre class="language-lua"><code class="language-lua"><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'rust-tools'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  server <span class="token operator">=</span> <span class="token punctuation">{</span>
    settings <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token punctuation">[</span><span class="token string">"rust-analyzer"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        rustc <span class="token operator">=</span> <span class="token punctuation">{</span>
          source <span class="token operator">=</span> <span class="token string">"discover"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div>
<hr>
<p><code>rust-tools</code>の<a href="https://github.com/simrat39/rust-tools.nvim#configuration" target="_blank" rel="nofollow noopener noreferrer">#configuration</a>の項を見ると、<code>rust-analyzer</code>へのオプションを渡す<code>server</code>が用意されていることがわかる.</p>
<div class="remark-highlight"><pre data-file="rust-tools.nvim#configuration" class="language-lua"><code class="language-lua"><span class="token comment">-- all the opts to send to nvim-lspconfig</span>
  <span class="token comment">-- these override the defaults set by rust-tools.nvim</span>
  <span class="token comment">-- see <a href="https://github.com/neovim/nvim-lspconfig/blob/master/doc/server_configurations.md#rust_analyzer" class="token url-link">https://github.com/neovim/nvim-lspconfig/blob/master/doc/server_configurations.md#rust_analyzer</a></span>
  server <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">-- standalone file support</span>
    <span class="token comment">-- setting it to false may improve startup time</span>
    standalone <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">-- rust-analyzer options</span>
</code></pre></div>
<blockquote>
<p>all the opts to send to nvim-lspconfig</p>
</blockquote>
<p>とあるので、<code>nvim-lspconfig</code>での設定をそのまま<code>rust-tools</code>の<code>server</code>に記述すればよいのだが、当時の自分は"そうは言っても<code>["rust-analyzer"]</code>ディレクティブに渡すのだろう"と思い込みんでいた.</p></div></article><div class="CommitLogs_commit_logs__W6xPi" role="log"><h2>Commits</h2><details><summary><span class="CommitLogs_commit__date___q8bm">2022-10-30 14:46:09</span><span class="CommitLogs_commit__hash__Xyu7v">8733dd35</span><span class="CommitLogs_commit__message__IGUPv">add note</span></summary><div><div class="remark-highlight"><pre data-file="8733dd35.patch" class="language-git  language-diff"><code class="language-git"><span class="token commit-sha1">commit 8733dd3554345ab4543ae9927dd51a40c1a89585</span>
Author: koka &#x26;<a href="mailto:lt;koka.code@gmail.com" class="token email-link">lt;koka.code@gmail.com</a>&#x26;gt;
Date:   Sun Oct 30 14:46:09 2022 +0900

  add note

diff --git a/_posts/2022_10_30_rust-tools-for-clippy.md b/_posts/2022_10_30_rust-tools-for-clippy.md
new file mode 100644
index 0000000..c6142c3
<span class="token deleted">--- /dev/null</span>
<span class="token inserted">+++ b/_posts/2022_10_30_rust-tools-for-clippy.md</span>
<span class="token coord">@@ -0,0 +1,60 @@</span>
<span class="token inserted">+---</span>
<span class="token inserted">+title: clippyの開発でもrust-analyzerを使いたい</span>
<span class="token inserted">+date: 2022-10-30</span>
<span class="token inserted">+categories:</span>
<span class="token inserted">+- memo</span>
<span class="token inserted">+tags:</span>
<span class="token inserted">+- Rust</span>
<span class="token inserted">+description: rust-tools.nvim(nvim-lspconfig)でrust-clippyの開発時にrust-analyzerの補完を有効化するための設定方法</span>
<span class="token inserted">+---</span>
<span class="token inserted">+</span>
<span class="token inserted">+[rust-clippy][clippy]はrustcのAPIを利用しており、`clippy`のソースコードを編集する際、デフォルトでは[rust-analyzer][analzer]の補完が効かない.</span>
<span class="token inserted">+そのため`rust-analyzer`に対し以下の設定が必要.</span>
<span class="token inserted">+</span>
<span class="token inserted">+\```json</span>
<span class="token inserted">+{ "rust-analyzer.rustc.source": "discover" }</span>
<span class="token inserted">+\```</span>
<span class="token inserted">+</span>
<span class="token inserted">+これを[rust-tools.nvim][tools]で設定する方法が若干わかりづらかったのでメモ.</span>
<span class="token inserted">+</span>
<span class="token inserted">+## TL;DR</span>
<span class="token inserted">+</span>
<span class="token inserted">+結論、以下の様に`server`に対し`settings.["rust-analyzer"]`を渡す.</span>
<span class="token inserted">+</span>
<span class="token inserted">+\```lua</span>
<span class="token inserted">+require('rust-tools').setup({</span>
<span class="token inserted">+  server = {</span>
<span class="token inserted">+    settings = {</span>
<span class="token inserted">+      ["rust-analyzer"] = {</span>
<span class="token inserted">+        rustc = {</span>
<span class="token inserted">+          source = "discover"</span>
<span class="token inserted">+        }</span>
<span class="token inserted">+      }</span>
<span class="token inserted">+    }</span>
<span class="token inserted">+  }</span>
<span class="token inserted">+})</span>
<span class="token inserted">+\```</span>
<span class="token inserted">+</span>
<span class="token inserted">+---</span>
<span class="token inserted">+</span>
<span class="token inserted">+`rust-tools`の[#configuration][config]の項を見ると、`rust-analyzer`へのオプションを渡す`server`が用意されていることがわかる.</span>
<span class="token inserted">+</span>
<span class="token inserted">+\```lua[data-file="rust-tools.nvim#configuration"]</span>
<span class="token inserted">+  -- all the opts to send to nvim-lspconfig</span>
<span class="token inserted">+  -- these override the defaults set by rust-tools.nvim</span>
<span class="token inserted">+  -- see https://github.com/neovim/nvim-lspconfig/blob/master/doc/server_configurations.md#rust_analyzer</span>
<span class="token inserted">+  server = {</span>
<span class="token inserted">+    -- standalone file support</span>
<span class="token inserted">+    -- setting it to false may improve startup time</span>
<span class="token inserted">+    standalone = true,</span>
<span class="token inserted">+  }, -- rust-analyzer options</span>
<span class="token inserted">+\```</span>
<span class="token inserted">+</span>
<span class="token inserted">+&#x26;gt; all the opts to send to nvim-lspconfig</span>
<span class="token inserted">+</span>
<span class="token inserted">+とあるので、`nvim-lspconfig`での設定をそのまま`rust-tools`の`server`に記述すればよいのだが、当時の自分は"そうは言っても`["rust-analyzer"]`ディレクティブに渡すのだろう"と思い込みんでいた.</span>
<span class="token inserted">+</span>
<span class="token inserted">+[clippy]: https://github.com/rust-lang/rust-clippy</span>
<span class="token inserted">+[analzer]: https://rust-analyzer.github.io/</span>
<span class="token inserted">+[tools]: https://github.com/simrat39/rust-tools.nvim</span>
<span class="token inserted">+[config]: https://github.com/simrat39/rust-tools.nvim#configuration</span>
</code></pre></div></div></details></div><div class="Comments_comment__WxfzD" role="comment"><h2 class="Comments_title__YENiL">Comments</h2><div id="github-comment-container"></div></div></div><aside class="slug_aside__gL3UH"><nav class="Toc_toc__nav__rl0h7" role="navigation"><ul class="Toc_toc__Y4dWA"></ul></nav></aside></div></main><footer class="Footer_footer__FDcZZ"><small>Code snippets licensed under MIT, unless otherwise noted.</small></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"2022_10_30_rust-tools-for-clippy","title":"clippyの開発でもrust-analyzerを使いたい","categories":["memo"],"image":"https://koka831.github.io/img/icon.png","tags":["Rust"],"content":"\u003cp\u003e\u003ca href=\"https://github.com/rust-lang/rust-clippy\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003erust-clippy\u003c/a\u003eはrustcのAPIを利用しており、\u003ccode\u003eclippy\u003c/code\u003eのソースコードを編集する際、デフォルトでは\u003ca href=\"https://rust-analyzer.github.io/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003erust-analyzer\u003c/a\u003eの補完が効かない.\nそのため\u003ccode\u003erust-analyzer\u003c/code\u003eに対し以下の設定が必要.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-json\"\u003e\u003ccode class=\"language-json\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token property\"\u003e\"rust-analyzer.rustc.source\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"discover\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eこれを\u003ca href=\"https://github.com/simrat39/rust-tools.nvim\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003erust-tools.nvim\u003c/a\u003eで設定する方法が若干わかりづらかったのでメモ.\u003c/p\u003e\n\u003ch2 id=\"tldr\"\u003e\u003ca href=\"#tldr\"\u003eTL;DR\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e結論、以下の様に\u003ccode\u003eserver\u003c/code\u003eに対し\u003ccode\u003esettings.[\"rust-analyzer\"]\u003c/code\u003eを渡す.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-lua\"\u003e\u003ccode class=\"language-lua\"\u003e\u003cspan class=\"token function\"\u003erequire\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'rust-tools'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esetup\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  server \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    settings \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"rust-analyzer\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        rustc \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n          source \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"discover\"\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003chr\u003e\n\u003cp\u003e\u003ccode\u003erust-tools\u003c/code\u003eの\u003ca href=\"https://github.com/simrat39/rust-tools.nvim#configuration\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003e#configuration\u003c/a\u003eの項を見ると、\u003ccode\u003erust-analyzer\u003c/code\u003eへのオプションを渡す\u003ccode\u003eserver\u003c/code\u003eが用意されていることがわかる.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre data-file=\"rust-tools.nvim#configuration\" class=\"language-lua\"\u003e\u003ccode class=\"language-lua\"\u003e\u003cspan class=\"token comment\"\u003e-- all the opts to send to nvim-lspconfig\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e-- these override the defaults set by rust-tools.nvim\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e-- see \u003ca href=\"https://github.com/neovim/nvim-lspconfig/blob/master/doc/server_configurations.md#rust_analyzer\" class=\"token url-link\"\u003ehttps://github.com/neovim/nvim-lspconfig/blob/master/doc/server_configurations.md#rust_analyzer\u003c/a\u003e\u003c/span\u003e\n  server \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e-- standalone file support\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e-- setting it to false may improve startup time\u003c/span\u003e\n    standalone \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token comment\"\u003e-- rust-analyzer options\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eall the opts to send to nvim-lspconfig\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eとあるので、\u003ccode\u003envim-lspconfig\u003c/code\u003eでの設定をそのまま\u003ccode\u003erust-tools\u003c/code\u003eの\u003ccode\u003eserver\u003c/code\u003eに記述すればよいのだが、当時の自分は\"そうは言っても\u003ccode\u003e[\"rust-analyzer\"]\u003c/code\u003eディレクティブに渡すのだろう\"と思い込みんでいた.\u003c/p\u003e","description":"rust-tools.nvim(nvim-lspconfig)でrust-clippyの開発時にrust-analyzerの補完を有効化するための設定方法","commits":[{"title":"add note","date":"2022-10-30 14:46:09","hash":"8733dd35","diff":"\u003cdiv class=\"remark-highlight\"\u003e\u003cpre data-file=\"8733dd35.patch\" class=\"language-git  language-diff\"\u003e\u003ccode class=\"language-git\"\u003e\u003cspan class=\"token commit-sha1\"\u003ecommit 8733dd3554345ab4543ae9927dd51a40c1a89585\u003c/span\u003e\nAuthor: koka \u0026#x26;\u003ca href=\"mailto:lt;koka.code@gmail.com\" class=\"token email-link\"\u003elt;koka.code@gmail.com\u003c/a\u003e\u0026#x26;gt;\nDate:   Sun Oct 30 14:46:09 2022 +0900\n\n  add note\n\ndiff --git a/_posts/2022_10_30_rust-tools-for-clippy.md b/_posts/2022_10_30_rust-tools-for-clippy.md\nnew file mode 100644\nindex 0000000..c6142c3\n\u003cspan class=\"token deleted\"\u003e--- /dev/null\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+++ b/_posts/2022_10_30_rust-tools-for-clippy.md\u003c/span\u003e\n\u003cspan class=\"token coord\"\u003e@@ -0,0 +1,60 @@\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+---\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+title: clippyの開発でもrust-analyzerを使いたい\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+date: 2022-10-30\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+categories:\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+- memo\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+tags:\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+- Rust\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+description: rust-tools.nvim(nvim-lspconfig)でrust-clippyの開発時にrust-analyzerの補完を有効化するための設定方法\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+---\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+[rust-clippy][clippy]はrustcのAPIを利用しており、`clippy`のソースコードを編集する際、デフォルトでは[rust-analyzer][analzer]の補完が効かない.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+そのため`rust-analyzer`に対し以下の設定が必要.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```json\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+{ \"rust-analyzer.rustc.source\": \"discover\" }\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+これを[rust-tools.nvim][tools]で設定する方法が若干わかりづらかったのでメモ.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+## TL;DR\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+結論、以下の様に`server`に対し`settings.[\"rust-analyzer\"]`を渡す.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```lua\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+require('rust-tools').setup({\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+  server = {\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    settings = {\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+      [\"rust-analyzer\"] = {\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+        rustc = {\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+          source = \"discover\"\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+        }\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+      }\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    }\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+  }\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+})\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+---\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+`rust-tools`の[#configuration][config]の項を見ると、`rust-analyzer`へのオプションを渡す`server`が用意されていることがわかる.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```lua[data-file=\"rust-tools.nvim#configuration\"]\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+  -- all the opts to send to nvim-lspconfig\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+  -- these override the defaults set by rust-tools.nvim\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+  -- see https://github.com/neovim/nvim-lspconfig/blob/master/doc/server_configurations.md#rust_analyzer\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+  server = {\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    -- standalone file support\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    -- setting it to false may improve startup time\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    standalone = true,\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+  }, -- rust-analyzer options\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u0026#x26;gt; all the opts to send to nvim-lspconfig\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+とあるので、`nvim-lspconfig`での設定をそのまま`rust-tools`の`server`に記述すればよいのだが、当時の自分は\"そうは言っても`[\"rust-analyzer\"]`ディレクティブに渡すのだろう\"と思い込みんでいた.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+[clippy]: https://github.com/rust-lang/rust-clippy\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+[analzer]: https://rust-analyzer.github.io/\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+[tools]: https://github.com/simrat39/rust-tools.nvim\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+[config]: https://github.com/simrat39/rust-tools.nvim#configuration\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e"}],"publishedAt":"2022-10-30","updatedAt":"2022-10-30"}},"__N_SSG":true},"page":"/archives/[slug]","query":{"slug":"2022_10_30_rust-tools-for-clippy"},"buildId":"znmYoLexqSmMsB-BwArHq","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>