<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta name="theme-color" content="#ddd4bb"/><meta property="og:type" content="website"/><meta property="og:url" content="https://koka831.github.io"/><meta property="og:site_name" content="/var/log/koka"/><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="/var/log/koka"/><meta name="twitter:site" content="@k_0ka"/><meta name="twitter:description" content="cat /var/log/koka &gt; /dev/null"/><link rel="alternate" type="application/rss+xml" href="https://koka831.github.io/feed.xml" title="/var/log/koka RSS2.0"/><title>UnionFind | /var/log/koka</title><meta property="title" content="UnionFind | /var/log/koka"/><meta property="og:title" content="UnionFind | /var/log/koka"/><meta property="twitter:title" content="UnionFind | /var/log/koka"/><meta property="description" content="rankしかもってなかった"/><meta property="og:description" content="rankしかもってなかった"/><meta property="twitter:description" content="rankしかもってなかった"/><meta property="og:image" content="https://koka831.github.io/img/icon.png"/><meta name="next-head-count" content="19"/><link rel="preload" href="/_next/static/css/3b95598d126ea80c3aba.css" as="style"/><link rel="stylesheet" href="/_next/static/css/3b95598d126ea80c3aba.css" data-n-g=""/><link rel="preload" href="/_next/static/css/36c296c4fdbd602228a5.css" as="style"/><link rel="stylesheet" href="/_next/static/css/36c296c4fdbd602228a5.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-90a60b87fd0d5fc150f2.js" defer=""></script><script src="/_next/static/chunks/framework-2191d16384373197bc0a.js" defer=""></script><script src="/_next/static/chunks/main-7c56bfc6d8ecbcc62d76.js" defer=""></script><script src="/_next/static/chunks/pages/_app-c841a4c9a7fbb3e3922d.js" defer=""></script><script src="/_next/static/chunks/cb1608f2-13e86362beaa0dcfd98b.js" defer=""></script><script src="/_next/static/chunks/935-9adc676da7ae634c9229.js" defer=""></script><script src="/_next/static/chunks/pages/archives/%5Bslug%5D-13d8b5ea136af0c63861.js" defer=""></script><script src="/_next/static/_njc3MGNpGe_FGkG-cKkB/_buildManifest.js" defer=""></script><script src="/_next/static/_njc3MGNpGe_FGkG-cKkB/_ssgManifest.js" defer=""></script></head><body><div id="__next"><nav class="Header_navigation__container__3D5xg"><div class="Header_navigation__16lxy"><a href="/">/var/log/koka</a></div><div><a href="/archives">archive</a></div></nav><main class="Layout_container__QVNsN"><div class="slug_container__2Nysm"><div class="slug_main__1TLKU"><article class="slug_article__3n4cv" role="article"><div itemscope="" class="ArticleHeader_header__container__AO3KC"><a class="ArticleHeader_post__title__2ujta" href="/archives/2019-03-08-unionfind">UnionFind</a><p>rankしかもってなかった</p><div class="ArticleHeader_flex__36wQ5"><div class="ArticleHeader_post__tags__18geI"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="tags" class="svg-inline--fa fa-tags fa-w-20 ArticleHeader_tags__icon__3kOkK" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M497.941 225.941L286.059 14.059A48 48 0 0 0 252.118 0H48C21.49 0 0 21.49 0 48v204.118a48 48 0 0 0 14.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882 0l204.118-204.118c18.745-18.745 18.745-49.137 0-67.882zM112 160c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882 0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397 0h48.721a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882z"></path></svg><p class="Tag_tag__FntIt">Graph</p><p class="Tag_tag__FntIt">TODO</p></div><div class="ArticleHeader_post__dates__s80K2"><time dateTime="2019-03-08" itemProp="datePublished" class="PublishDate_post__date__2Kcmg">published: <!-- -->2019-03-08</time><time dateTime="2021-01-30" itemProp="datePublished" class="PublishDate_post__date__2Kcmg">updated: 2021-01-30</time></div></div></div><div class="slug_article__body__3hx8l"><p><a href="https://atcoder.jp/contests/abc120" target="_blank" rel="nofollow noopener noreferrer">AtCoder Beginners Contest 120</a> で連結成分のsizeを計算するdisjoint-setの問題が出題された.
それまでrankを用いたUnion-Findしか経験がなかったので, この機会にまとめる.</p>
<h2 id="union-find"><a href="#union-find">Union-Find</a></h2>
<p>Union-Findは要素が同一の集合に含まれるかどうかを判定するデータ構造.</p>
<table>
<thead>
<tr>
<th>Query</th>
<th>Process</th>
</tr>
</thead>
<tbody>
<tr>
<td>unite(x, y)</td>
<td>X(x <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∈</mo></mrow><annotation encoding="application/x-tex">\in</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">∈</span></span></span></span></span> X)とY(y <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∈</mo></mrow><annotation encoding="application/x-tex">\in</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">∈</span></span></span></span></span> Y)をマージする</td>
</tr>
<tr>
<td>same(x, y)</td>
<td>X == Y か判定する</td>
</tr>
</tbody>
</table>
<p>の操作を</p>
<p>各要素を1つのノード, 集合を木と表現する.
要素が同一の集合に含まれる場合, それらの要素は同一の木のノードである.</p>
<p>上記操作をならし計算量<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>α</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(\alpha(n))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">))</span></span></span></span></span>で行う<sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup>ためのマージ戦略が以下の経路圧縮とrankである.</p>
<h3 id="経路圧縮"><a href="#%E7%B5%8C%E8%B7%AF%E5%9C%A7%E7%B8%AE">経路圧縮</a></h3>
<p>要素が同一の木のノードであるか判定する場合, 各要素のrootが同一かどうか見ればよい.
ただその場合木の高さだけ再帰的に親ノードを辿る必要がある.<br>
そこで, 親ノードを調べる際に調べたノードをrootに直接つなぎ直すことで,次回以降の判定時の計算量を<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span>に削減する.</p>
<h3 id="rank"><a href="#rank">Rank</a></h3>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mi>n</mi><mi>i</mi><mi>t</mi><mi>e</mi><mo stretchy="false">(</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">unite()</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal">ni</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mclose">)</span></span></span></span></span>操作時に木の高さが高い方を親として, 低い方を高い方に繋げるようにする.</p>
<p>ここで, 経路圧縮と併用する場合には圧縮前の高さでrankを持つ必要がある.
経路圧縮は<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mi>i</mi><mi>n</mi><mi>d</mi><mo stretchy="false">(</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">find()</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">in</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mclose">)</span></span></span></span></span>操作時に行うため, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mi>n</mi><mi>i</mi><mi>t</mi><mi>e</mi><mo stretchy="false">(</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">unite()</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal">ni</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mclose">)</span></span></span></span></span>の段階では必ずしも木の高さが<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></span>となっている保証はない.</p>
<details>
<summary>以下は経路圧縮のみの実装例.</summary>
<div>
<div class="remark-highlight"><pre class="language-rust"><code class="language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">UnionFind</span> <span class="token punctuation">{</span>
  par<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&#x3C;</span><span class="token keyword">usize</span><span class="token operator">></span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">UnionFind</span> <span class="token punctuation">{</span>
  <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>n<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
    <span class="token class-name">UnionFind</span> <span class="token punctuation">{</span>
      par<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">..</span>n<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">fn</span> <span class="token function-definition function">unite</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> x<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> px <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> py <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> px <span class="token operator">==</span> py <span class="token punctuation">{</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>par<span class="token punctuation">[</span>py<span class="token punctuation">]</span> <span class="token operator">=</span> px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">fn</span> <span class="token function-definition function">same</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> x<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">bool</span> <span class="token punctuation">{</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">fn</span> <span class="token function-definition function">find</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> x<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">usize</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>par<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">==</span> x <span class="token punctuation">{</span> x <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 経路圧縮</span>
      <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>par<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">self</span><span class="token punctuation">.</span>par<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">self</span><span class="token punctuation">.</span>par<span class="token punctuation">[</span>x<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
</div>
</details>
<h2 id="decayed-bridges"><a href="#decayed-bridges"><a href="https://atcoder.jp/contests/abc120/tasks/abc120_d" target="_blank" rel="nofollow noopener noreferrer">Decayed Bridges</a></a></h2>
<p>本題.</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">n</span></span></span></span></span>頂点<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">m</span></span></span></span></span>辺の無向単純グラフの辺<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>∈</mo><mi>M</mi></mrow><annotation encoding="application/x-tex">i \in M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69862em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span></span>を順番に取り除いたとき, 時刻<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">i</span></span></span></span></span>でアクセスできない頂点が何組あるか.</p>
<h3 id="かんがえたこと"><a href="#%E3%81%8B%E3%82%93%E3%81%8C%E3%81%88%E3%81%9F%E3%81%93%E3%81%A8">かんがえたこと</a></h3>
<p>Union-Findでは要素を統合することはできても分割操作は行えない.
辺を除去する操作を考える場合にはグラフ全体を保持する必要が出てきてしまう. でも<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo separator="true">,</mo><mi>m</mi><mo>≤</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding="application/x-tex">n, m \leq 10^5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8304100000000001em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span></span></span></span></span>で隣接グラフを持つのはエグいし連結判定が厳しい.</p>
<p>では操作を巻き戻すとどうなるかを考えた.</p>
<p>まず辺をすべて取り除いた状態から開始し，辺を追加していく.<br>
このアプローチならUnion-Findで管理できる.</p>
<p>辺を追加することで<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">a</span></span></span></span></span>頂点と<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">b</span></span></span></span></span>頂点が新たに連結されたとすると, アクセスできる頂点ペアは<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>∗</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a * b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.46528em;vertical-align:0em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">b</span></span></span></span></span>個増える.
この連結された頂点の増加判定は<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>a</mi><mi>m</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">same</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">am</span><span class="mord mathnormal">e</span></span></span></span></span>操作を<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mi>n</mi><mi>i</mi><mi>t</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">unite</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal">ni</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span></span></span></span></span>操作の前後に行うことで行える.</p>
<p>が, Union-Findで集合の要素数を持つケースを初めて見たのでやや手間取った. 本番では構造体に要素数<code class="language-unknown">siz</code>を<code class="language-unknown">Vec</code>で保持させて<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mi>n</mi><mi>i</mi><mi>t</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">unite</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathnormal">u</span><span class="mord mathnormal">ni</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span></span></span></span></span>時に更新してなんとかなった.</p>
<p>::: tip 追記
この辺が存在した場合の連結する頂点数を考えると, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>∗</mo><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">n * (n - 1) / 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.46528em;vertical-align:0em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord">/2</span></span></span></span></span>なのでここから引いてくと楽.
:::</p>
<details>
<summary>解答</summary>
<div>
<div class="remark-highlight"><pre class="language-rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span>n<span class="token punctuation">,</span> m<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">::</span><span class="token operator">&#x3C;</span><span class="token keyword">usize</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">(</span>i<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> <span class="token keyword">mut</span> ab <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span>m <span class="token punctuation">{</span>
        <span class="token keyword">let</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">::</span><span class="token operator">&#x3C;</span><span class="token keyword">usize</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">(</span>i<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        ab<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> <span class="token keyword">mut</span> uf <span class="token operator">=</span> <span class="token class-name">UnionFind</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> cost <span class="token operator">=</span> n <span class="token operator">*</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> ans <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token keyword">in</span> ab<span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rev</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ans<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cost<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> uf<span class="token punctuation">.</span><span class="token function">same</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">let</span> pa <span class="token operator">=</span> uf<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> pb <span class="token operator">=</span> uf<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> c <span class="token operator">=</span> uf<span class="token punctuation">.</span>siz<span class="token punctuation">[</span>pa<span class="token punctuation">]</span> <span class="token operator">*</span> uf<span class="token punctuation">.</span>siz<span class="token punctuation">[</span>pb<span class="token punctuation">]</span><span class="token punctuation">;</span>
        uf<span class="token punctuation">.</span><span class="token function">unite</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cost <span class="token operator">-=</span> c<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> a <span class="token keyword">in</span> ans<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rev</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
</div>
</details>
<h2 id="所感"><a href="#%E6%89%80%E6%84%9F">所感</a></h2>
<p>unite by rankとunite by sizeは本質的には同じなので落ち着いて対処したかった.</p>
<p>またrankに符号付き整数を用いて, 正負でsize or rankを表すテクもあることを知った.</p>
<p>::: tip TODO
basic (<a href="https://atcoder.jp/contests/abc075/tasks/abc075_c" target="_blank" rel="nofollow noopener noreferrer">Bridge/ABC075</a>)<br>
weighted(Potential) Union-Find (<a href="https://atcoder.jp/contests/abc087/tasks/arc090_b" target="_blank" rel="nofollow noopener noreferrer">People on a line/ABC087</a>)<br>
永続UF (<a href="https://agc002.contest.atcoder.jp/tasks/agc002_d" target="_blank" rel="nofollow noopener noreferrer">Stamp Rally/AGC002</a>)<br>
わからん (<a href="https://agc015.contest.atcoder.jp/tasks/agc015_c" target="_blank" rel="nofollow noopener noreferrer">Nuske vs Phantom Thnook/AGC015</a>)
:::</p>
<div class="footnotes">
<hr>
<ol>
<li id="fn-1"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>α</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><mi>A</mi><mi>c</mi><mi>k</mi><mi>e</mi><mi>r</mi><mi>m</mi><mi>a</mi><mi>n</mi><mo stretchy="false">(</mo><mi>n</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\alpha^{-1}(n) = Ackerman(n, n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal">man</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></span>. 経路圧縮とrankどちらかのみの場合はならし計算量<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></span>.<a href="#fnref-1" class="footnote-backref">↩</a></li>
</ol>
</div></div></article><div class="CommitLogs_commit_logs__2xJyI" role="log"><h2>Commits</h2><details><summary><span class="CommitLogs_commit__date__Vg5RN">2021-01-30 22:18:17</span><span class="CommitLogs_commit__hash__2k3a3">35b550ae</span><span class="CommitLogs_commit__message__nS85e">copy md</span></summary><div><div class="remark-highlight"><pre data-file="35b550ae.patch" class="language-git  language-diff"><code class="language-git"><span class="token commit-sha1">commit 35b550ae83af4efaeadf33471c8ca8a32c1079c8</span>
Author: koka &#x26;<a href="mailto:lt;koka.code@gmail.com" class="token email-link">lt;koka.code@gmail.com</a>&#x26;gt;
Date:   Sat Jan 30 22:18:17 2021 +0900

  copy md

diff --git a/_posts/2019-03-08-unionfind.md b/_posts/2019-03-08-unionfind.md
new file mode 100644
index 0000000..dc993c9
<span class="token deleted">--- /dev/null</span>
<span class="token inserted">+++ b/_posts/2019-03-08-unionfind.md</span>
<span class="token coord">@@ -0,0 +1,163 @@</span>
<span class="token inserted">+---</span>
<span class="token inserted">+title: UnionFind</span>
<span class="token inserted">+date: 2019-03-08</span>
<span class="token inserted">+categories:</span>
<span class="token inserted">+- Competitive Programming</span>
<span class="token inserted">+tags:</span>
<span class="token inserted">+- Graph</span>
<span class="token inserted">+- TODO</span>
<span class="token inserted">+description: rankしかもってなかった</span>
<span class="token inserted">+---</span>
<span class="token inserted">+</span>
<span class="token inserted">+[AtCoder Beginners Contest 120](https://atcoder.jp/contests/abc120) で連結成分のsizeを計算するdisjoint-setの問題が出題された.</span>
<span class="token inserted">+それまでrankを用いたUnion-Findしか経験がなかったので, この機会にまとめる.</span>
<span class="token inserted">+</span>
<span class="token inserted">+## Union-Find</span>
<span class="token inserted">+Union-Findは要素が同一の集合に含まれるかどうかを判定するデータ構造.</span>
<span class="token inserted">+</span>
<span class="token inserted">+| Query      | Process       |</span>
<span class="token inserted">+|------------|---------------|</span>
<span class="token inserted">+| unite(x, y)|X(x $\in$ X)とY(y $\in$ Y)をマージする |</span>
<span class="token inserted">+| same(x, y) |X == Y か判定する   |</span>
<span class="token inserted">+</span>
<span class="token inserted">+の操作を</span>
<span class="token inserted">+</span>
<span class="token inserted">+各要素を1つのノード, 集合を木と表現する.</span>
<span class="token inserted">+要素が同一の集合に含まれる場合, それらの要素は同一の木のノードである.</span>
<span class="token inserted">+</span>
<span class="token inserted">+</span>
<span class="token inserted">+上記操作をならし計算量$O(\alpha(n))$で行う[^1]ためのマージ戦略が以下の経路圧縮とrankである.</span>
<span class="token inserted">+</span>
<span class="token inserted">+### 経路圧縮</span>
<span class="token inserted">+要素が同一の木のノードであるか判定する場合, 各要素のrootが同一かどうか見ればよい.</span>
<span class="token inserted">+ただその場合木の高さだけ再帰的に親ノードを辿る必要がある.  </span>
<span class="token inserted">+そこで, 親ノードを調べる際に調べたノードをrootに直接つなぎ直すことで,次回以降の判定時の計算量を$O(1)$に削減する.</span>
<span class="token inserted">+</span>
<span class="token inserted">+</span>
<span class="token inserted">+### Rank</span>
<span class="token inserted">+$unite()$操作時に木の高さが高い方を親として, 低い方を高い方に繋げるようにする.</span>
<span class="token inserted">+</span>
<span class="token inserted">+ここで, 経路圧縮と併用する場合には圧縮前の高さでrankを持つ必要がある.</span>
<span class="token inserted">+経路圧縮は$find()$操作時に行うため, $unite()$の段階では必ずしも木の高さが$1$となっている保証はない.</span>
<span class="token inserted">+</span>
<span class="token inserted">+&#x26;lt;details&#x26;gt;</span>
<span class="token inserted">+&#x26;lt;summary&#x26;gt;以下は経路圧縮のみの実装例.&#x26;lt;/summary&#x26;gt;</span>
<span class="token inserted">+&#x26;lt;div&#x26;gt;</span>
<span class="token inserted">+</span>
<span class="token inserted">+\```rust</span>
<span class="token inserted">+struct UnionFind {</span>
<span class="token inserted">+  par: Vec&#x26;lt;usize&#x26;gt;,</span>
<span class="token inserted">+}</span>
<span class="token inserted">+</span>
<span class="token inserted">+impl UnionFind {</span>
<span class="token inserted">+  fn new(n: usize) -&#x26;gt; Self {</span>
<span class="token inserted">+    UnionFind {</span>
<span class="token inserted">+      par: (0..n).collect(),</span>
<span class="token inserted">+    }</span>
<span class="token inserted">+  }</span>
<span class="token inserted">+</span>
<span class="token inserted">+  fn unite(&#x26;mut self, x: usize, y: usize) {</span>
<span class="token inserted">+    let px = self.find(x);</span>
<span class="token inserted">+    let py = self.find(y);</span>
<span class="token inserted">+    if px == py { return; }</span>
<span class="token inserted">+    self.par[py] = px;</span>
<span class="token inserted">+  }</span>
<span class="token inserted">+</span>
<span class="token inserted">+  fn same(&#x26;mut self, x: usize, y: usize) -&#x26;gt; bool {</span>
<span class="token inserted">+    self.find(x) == self.find(y)</span>
<span class="token inserted">+  }</span>
<span class="token inserted">+</span>
<span class="token inserted">+  fn find(&#x26;mut self, x: usize) -&#x26;gt; usize {</span>
<span class="token inserted">+    if self.par[x] == x { x }</span>
<span class="token inserted">+    else {</span>
<span class="token inserted">+      // 経路圧縮</span>
<span class="token inserted">+      let p = self.par[x];</span>
<span class="token inserted">+      self.par[x] = self.find(p);</span>
<span class="token inserted">+      self.par[x]</span>
<span class="token inserted">+    }</span>
<span class="token inserted">+  }</span>
<span class="token inserted">+}</span>
<span class="token inserted">+\```</span>
<span class="token inserted">+&#x26;lt;/div&#x26;gt;</span>
<span class="token inserted">+&#x26;lt;/details&#x26;gt;</span>
<span class="token inserted">+</span>
<span class="token inserted">+## [Decayed Bridges](https://atcoder.jp/contests/abc120/tasks/abc120_d)</span>
<span class="token inserted">+</span>
<span class="token inserted">+本題.</span>
<span class="token inserted">+</span>
<span class="token inserted">+$n$頂点$m$辺の無向単純グラフの辺$i \in M$を順番に取り除いたとき, 時刻$i$でアクセスできない頂点が何組あるか.</span>
<span class="token inserted">+</span>
<span class="token inserted">+### かんがえたこと</span>
<span class="token inserted">+</span>
<span class="token inserted">+Union-Findでは要素を統合することはできても分割操作は行えない.</span>
<span class="token inserted">+辺を除去する操作を考える場合にはグラフ全体を保持する必要が出てきてしまう. でも$n, m \leq 10^5$で隣接グラフを持つのはエグいし連結判定が厳しい.</span>
<span class="token inserted">+</span>
<span class="token inserted">+では操作を巻き戻すとどうなるかを考えた.</span>
<span class="token inserted">+</span>
<span class="token inserted">+まず辺をすべて取り除いた状態から開始し，辺を追加していく.  </span>
<span class="token inserted">+このアプローチならUnion-Findで管理できる.</span>
<span class="token inserted">+</span>
<span class="token inserted">+辺を追加することで$a$頂点と$b$頂点が新たに連結されたとすると, アクセスできる頂点ペアは$a * b$個増える.</span>
<span class="token inserted">+この連結された頂点の増加判定は$same$操作を$unite$操作の前後に行うことで行える.</span>
<span class="token inserted">+</span>
<span class="token inserted">+が, Union-Findで集合の要素数を持つケースを初めて見たのでやや手間取った. 本番では構造体に要素数`siz`を`Vec`で保持させて$unite$時に更新してなんとかなった.</span>
<span class="token inserted">+</span>
<span class="token inserted">+::: tip 追記</span>
<span class="token inserted">+この辺が存在した場合の連結する頂点数を考えると, $n * (n - 1) / 2$なのでここから引いてくと楽.</span>
<span class="token inserted">+:::</span>
<span class="token inserted">+</span>
<span class="token inserted">+&#x26;lt;details&#x26;gt;</span>
<span class="token inserted">+&#x26;lt;summary&#x26;gt;解答&#x26;lt;/summary&#x26;gt;</span>
<span class="token inserted">+&#x26;lt;div&#x26;gt;</span>
<span class="token inserted">+</span>
<span class="token inserted">+\```rust</span>
<span class="token inserted">+fn main() {</span>
<span class="token inserted">+    let (n, m) = {</span>
<span class="token inserted">+        let i = read::&#x26;lt;usize&#x26;gt;();</span>
<span class="token inserted">+        (i[0], i[1])</span>
<span class="token inserted">+    };</span>
<span class="token inserted">+</span>
<span class="token inserted">+    let mut ab = Vec::new();</span>
<span class="token inserted">+    for _ in 0..m {</span>
<span class="token inserted">+        let (a, b) = {</span>
<span class="token inserted">+            let i = read::&#x26;lt;usize&#x26;gt;();</span>
<span class="token inserted">+            (i[0], i[1])</span>
<span class="token inserted">+        };</span>
<span class="token inserted">+        ab.push((a, b));</span>
<span class="token inserted">+    }</span>
<span class="token inserted">+</span>
<span class="token inserted">+    let mut uf = UnionFind::new(n + 1);</span>
<span class="token inserted">+    let mut cost = n * (n - 1) / 2;</span>
<span class="token inserted">+    let mut ans = Vec::new();</span>
<span class="token inserted">+</span>
<span class="token inserted">+    for (a, b) in ab.into_iter().rev() {</span>
<span class="token inserted">+        ans.push(cost);</span>
<span class="token inserted">+        if uf.same(a, b) { continue; }</span>
<span class="token inserted">+        let pa = uf.find(a);</span>
<span class="token inserted">+        let pb = uf.find(b);</span>
<span class="token inserted">+        let c = uf.siz[pa] * uf.siz[pb];</span>
<span class="token inserted">+        uf.unite(a, b);</span>
<span class="token inserted">+        cost -= c;</span>
<span class="token inserted">+    }</span>
<span class="token inserted">+</span>
<span class="token inserted">+    for a in ans.iter().rev() {</span>
<span class="token inserted">+        println!("{}", a);</span>
<span class="token inserted">+    }</span>
<span class="token inserted">+}</span>
<span class="token inserted">+\```</span>
<span class="token inserted">+&#x26;lt;/div&#x26;gt;</span>
<span class="token inserted">+&#x26;lt;/details&#x26;gt;</span>
<span class="token inserted">+</span>
<span class="token inserted">+## 所感</span>
<span class="token inserted">+unite by rankとunite by sizeは本質的には同じなので落ち着いて対処したかった.</span>
<span class="token inserted">+</span>
<span class="token inserted">+またrankに符号付き整数を用いて, 正負でsize or rankを表すテクもあることを知った.</span>
<span class="token inserted">+</span>
<span class="token inserted">+::: tip TODO</span>
<span class="token inserted">+basic ([Bridge/ABC075](https://atcoder.jp/contests/abc075/tasks/abc075_c))  </span>
<span class="token inserted">+weighted(Potential) Union-Find ([People on a line/ABC087](https://atcoder.jp/contests/abc087/tasks/arc090_b))  </span>
<span class="token inserted">+永続UF ([Stamp Rally/AGC002](https://agc002.contest.atcoder.jp/tasks/agc002_d))  </span>
<span class="token inserted">+わからん ([Nuske vs Phantom Thnook/AGC015](https://agc015.contest.atcoder.jp/tasks/agc015_c))</span>
<span class="token inserted">+:::</span>
<span class="token inserted">+</span>
<span class="token inserted">+[^1]: $\alpha^{-1}(n) = Ackerman(n, n)$. 経路圧縮とrankどちらかのみの場合はならし計算量$O(log n)$.</span>
</code></pre></div></div></details></div><div class="Comments_comment__3jxzl" role="comment"><h2 class="Comments_title__19pGw">Comments</h2><div id="github-comment-container"></div></div></div><aside class="slug_aside__1vC-U"><nav class="Toc_toc__nav__2o5GC" role="navigation"><ul class="Toc_toc__3i1gg"></ul></nav></aside></div></main><footer class="Footer_footer__cAlbN"><small>Code snippets licensed under MIT, unless otherwise noted.</small></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"2019-03-08-unionfind","title":"UnionFind","categories":["Competitive Programming"],"image":"https://koka831.github.io/img/icon.png","tags":["Graph","TODO"],"content":"\u003cp\u003e\u003ca href=\"https://atcoder.jp/contests/abc120\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003eAtCoder Beginners Contest 120\u003c/a\u003e で連結成分のsizeを計算するdisjoint-setの問題が出題された.\nそれまでrankを用いたUnion-Findしか経験がなかったので, この機会にまとめる.\u003c/p\u003e\n\u003ch2 id=\"union-find\"\u003e\u003ca href=\"#union-find\"\u003eUnion-Find\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eUnion-Findは要素が同一の集合に含まれるかどうかを判定するデータ構造.\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eQuery\u003c/th\u003e\n\u003cth\u003eProcess\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003eunite(x, y)\u003c/td\u003e\n\u003ctd\u003eX(x \u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmo\u003e∈\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\in\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e∈\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e X)とY(y \u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmo\u003e∈\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\in\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e∈\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e Y)をマージする\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003esame(x, y)\u003c/td\u003e\n\u003ctd\u003eX == Y か判定する\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003eの操作を\u003c/p\u003e\n\u003cp\u003e各要素を1つのノード, 集合を木と表現する.\n要素が同一の集合に含まれる場合, それらの要素は同一の木のノードである.\u003c/p\u003e\n\u003cp\u003e上記操作をならし計算量\u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eO\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003eα\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eO(\\alpha(n))\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\"\u003eO\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.0037em;\"\u003eα\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003en\u003c/span\u003e\u003cspan class=\"mclose\"\u003e))\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003eで行う\u003csup id=\"fnref-1\"\u003e\u003ca href=\"#fn-1\" class=\"footnote-ref\"\u003e1\u003c/a\u003e\u003c/sup\u003eためのマージ戦略が以下の経路圧縮とrankである.\u003c/p\u003e\n\u003ch3 id=\"経路圧縮\"\u003e\u003ca href=\"#%E7%B5%8C%E8%B7%AF%E5%9C%A7%E7%B8%AE\"\u003e経路圧縮\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e要素が同一の木のノードであるか判定する場合, 各要素のrootが同一かどうか見ればよい.\nただその場合木の高さだけ再帰的に親ノードを辿る必要がある.\u003cbr\u003e\nそこで, 親ノードを調べる際に調べたノードをrootに直接つなぎ直すことで,次回以降の判定時の計算量を\u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eO\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eO(1)\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\"\u003eO\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord\"\u003e1\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003eに削減する.\u003c/p\u003e\n\u003ch3 id=\"rank\"\u003e\u003ca href=\"#rank\"\u003eRank\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e\u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eu\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmi\u003ei\u003c/mi\u003e\u003cmi\u003et\u003c/mi\u003e\u003cmi\u003ee\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eunite()\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eu\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eni\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003et\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ee\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e操作時に木の高さが高い方を親として, 低い方を高い方に繋げるようにする.\u003c/p\u003e\n\u003cp\u003eここで, 経路圧縮と併用する場合には圧縮前の高さでrankを持つ必要がある.\n経路圧縮は\u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ef\u003c/mi\u003e\u003cmi\u003ei\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmi\u003ed\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003efind()\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\"\u003ef\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ein\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ed\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e操作時に行うため, \u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eu\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmi\u003ei\u003c/mi\u003e\u003cmi\u003et\u003c/mi\u003e\u003cmi\u003ee\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eunite()\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eu\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eni\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003et\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ee\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003eの段階では必ずしも木の高さが\u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e1\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003eとなっている保証はない.\u003c/p\u003e\n\u003cdetails\u003e\n\u003csummary\u003e以下は経路圧縮のみの実装例.\u003c/summary\u003e\n\u003cdiv\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-rust\"\u003e\u003ccode class=\"language-rust\"\u003e\u003cspan class=\"token keyword\"\u003estruct\u003c/span\u003e \u003cspan class=\"token type-definition class-name\"\u003eUnionFind\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  par\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eVec\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eusize\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eimpl\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eUnionFind\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003efn\u003c/span\u003e \u003cspan class=\"token function-definition function\"\u003enew\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003en\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eusize\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e-\u003e\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eSelf\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token class-name\"\u003eUnionFind\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      par\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e..\u003c/span\u003en\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ecollect\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"token keyword\"\u003efn\u003c/span\u003e \u003cspan class=\"token function-definition function\"\u003eunite\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003emut\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eself\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e x\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eusize\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e y\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eusize\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e px \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eself\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003efind\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ex\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e py \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eself\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003efind\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ey\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e px \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e py \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eself\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epar\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003epy\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e px\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"token keyword\"\u003efn\u003c/span\u003e \u003cspan class=\"token function-definition function\"\u003esame\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003emut\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eself\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e x\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eusize\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e y\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eusize\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e-\u003e\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ebool\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eself\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003efind\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ex\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eself\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003efind\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ey\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"token keyword\"\u003efn\u003c/span\u003e \u003cspan class=\"token function-definition function\"\u003efind\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003emut\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eself\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e x\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eusize\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e-\u003e\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eusize\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eself\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epar\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ex\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e x \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e x \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token comment\"\u003e// 経路圧縮\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e p \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eself\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epar\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ex\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003eself\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epar\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ex\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eself\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003efind\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ep\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003eself\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epar\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ex\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003c/details\u003e\n\u003ch2 id=\"decayed-bridges\"\u003e\u003ca href=\"#decayed-bridges\"\u003e\u003ca href=\"https://atcoder.jp/contests/abc120/tasks/abc120_d\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003eDecayed Bridges\u003c/a\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e本題.\u003c/p\u003e\n\u003cp\u003e\u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003en\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e頂点\u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003em\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003em\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003em\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e辺の無向単純グラフの辺\u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ei\u003c/mi\u003e\u003cmo\u003e∈\u003c/mo\u003e\u003cmi\u003eM\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ei \\in M\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.69862em;vertical-align:-0.0391em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ei\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e∈\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.10903em;\"\u003eM\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003eを順番に取り除いたとき, 時刻\u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ei\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ei\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ei\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003eでアクセスできない頂点が何組あるか.\u003c/p\u003e\n\u003ch3 id=\"かんがえたこと\"\u003e\u003ca href=\"#%E3%81%8B%E3%82%93%E3%81%8C%E3%81%88%E3%81%9F%E3%81%93%E3%81%A8\"\u003eかんがえたこと\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eUnion-Findでは要素を統合することはできても分割操作は行えない.\n辺を除去する操作を考える場合にはグラフ全体を保持する必要が出てきてしまう. でも\u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo separator=\"true\"\u003e,\u003c/mo\u003e\u003cmi\u003em\u003c/mi\u003e\u003cmo\u003e≤\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmsup\u003e\u003cmn\u003e0\u003c/mn\u003e\u003cmn\u003e5\u003c/mn\u003e\u003c/msup\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003en, m \\leq 10^5\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8304100000000001em;vertical-align:-0.19444em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003en\u003c/span\u003e\u003cspan class=\"mpunct\"\u003e,\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003em\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e≤\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e1\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord\"\u003e0\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.8141079999999999em;\"\u003e\u003cspan style=\"top:-3.063em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e5\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003eで隣接グラフを持つのはエグいし連結判定が厳しい.\u003c/p\u003e\n\u003cp\u003eでは操作を巻き戻すとどうなるかを考えた.\u003c/p\u003e\n\u003cp\u003eまず辺をすべて取り除いた状態から開始し，辺を追加していく.\u003cbr\u003e\nこのアプローチならUnion-Findで管理できる.\u003c/p\u003e\n\u003cp\u003e辺を追加することで\u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ea\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ea\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ea\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e頂点と\u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eb\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eb\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eb\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e頂点が新たに連結されたとすると, アクセスできる頂点ペアは\u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ea\u003c/mi\u003e\u003cmo\u003e∗\u003c/mo\u003e\u003cmi\u003eb\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ea * b\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.46528em;vertical-align:0em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ea\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e∗\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eb\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e個増える.\nこの連結された頂点の増加判定は\u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003es\u003c/mi\u003e\u003cmi\u003ea\u003c/mi\u003e\u003cmi\u003em\u003c/mi\u003e\u003cmi\u003ee\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003esame\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003es\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eam\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ee\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e操作を\u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eu\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmi\u003ei\u003c/mi\u003e\u003cmi\u003et\u003c/mi\u003e\u003cmi\u003ee\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eunite\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eu\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eni\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003et\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ee\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e操作の前後に行うことで行える.\u003c/p\u003e\n\u003cp\u003eが, Union-Findで集合の要素数を持つケースを初めて見たのでやや手間取った. 本番では構造体に要素数\u003ccode class=\"language-unknown\"\u003esiz\u003c/code\u003eを\u003ccode class=\"language-unknown\"\u003eVec\u003c/code\u003eで保持させて\u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eu\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmi\u003ei\u003c/mi\u003e\u003cmi\u003et\u003c/mi\u003e\u003cmi\u003ee\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eunite\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eu\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eni\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003et\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ee\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e時に更新してなんとかなった.\u003c/p\u003e\n\u003cp\u003e::: tip 追記\nこの辺が存在した場合の連結する頂点数を考えると, \u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo\u003e∗\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo\u003e−\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmi mathvariant=\"normal\"\u003e/\u003c/mi\u003e\u003cmn\u003e2\u003c/mn\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003en * (n - 1) / 2\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.46528em;vertical-align:0em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003en\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e∗\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003en\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e−\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e1\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003cspan class=\"mord\"\u003e/2\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003eなのでここから引いてくと楽.\n:::\u003c/p\u003e\n\u003cdetails\u003e\n\u003csummary\u003e解答\u003c/summary\u003e\n\u003cdiv\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-rust\"\u003e\u003ccode class=\"language-rust\"\u003e\u003cspan class=\"token keyword\"\u003efn\u003c/span\u003e \u003cspan class=\"token function-definition function\"\u003emain\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003en\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e m\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e i \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eread\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e::\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eusize\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e i\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"token keyword\"\u003emut\u003c/span\u003e ab \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eVec\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e::\u003c/span\u003e\u003cspan class=\"token function\"\u003enew\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e _ \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e..\u003c/span\u003em \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ea\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e b\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e i \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003eread\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e::\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eusize\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e i\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        ab\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003epush\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ea\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e b\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"token keyword\"\u003emut\u003c/span\u003e uf \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eUnionFind\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e::\u003c/span\u003e\u003cspan class=\"token function\"\u003enew\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003en \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"token keyword\"\u003emut\u003c/span\u003e cost \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e n \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003en \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e \u003cspan class=\"token keyword\"\u003emut\u003c/span\u003e ans \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eVec\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e::\u003c/span\u003e\u003cspan class=\"token function\"\u003enew\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ea\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e b\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e ab\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003einto_iter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003erev\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        ans\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003epush\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecost\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e uf\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003esame\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ea\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e b\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econtinue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e pa \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e uf\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003efind\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ea\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e pb \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e uf\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003efind\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eb\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e c \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e uf\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esiz\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003epa\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e uf\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esiz\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003epb\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        uf\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eunite\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ea\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e b\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n        cost \u003cspan class=\"token operator\"\u003e-=\u003c/span\u003e c\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e a \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e ans\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eiter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003erev\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token macro property\"\u003eprintln!\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"{}\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e a\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\u003c/details\u003e\n\u003ch2 id=\"所感\"\u003e\u003ca href=\"#%E6%89%80%E6%84%9F\"\u003e所感\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eunite by rankとunite by sizeは本質的には同じなので落ち着いて対処したかった.\u003c/p\u003e\n\u003cp\u003eまたrankに符号付き整数を用いて, 正負でsize or rankを表すテクもあることを知った.\u003c/p\u003e\n\u003cp\u003e::: tip TODO\nbasic (\u003ca href=\"https://atcoder.jp/contests/abc075/tasks/abc075_c\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003eBridge/ABC075\u003c/a\u003e)\u003cbr\u003e\nweighted(Potential) Union-Find (\u003ca href=\"https://atcoder.jp/contests/abc087/tasks/arc090_b\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003ePeople on a line/ABC087\u003c/a\u003e)\u003cbr\u003e\n永続UF (\u003ca href=\"https://agc002.contest.atcoder.jp/tasks/agc002_d\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003eStamp Rally/AGC002\u003c/a\u003e)\u003cbr\u003e\nわからん (\u003ca href=\"https://agc015.contest.atcoder.jp/tasks/agc015_c\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003eNuske vs Phantom Thnook/AGC015\u003c/a\u003e)\n:::\u003c/p\u003e\n\u003cdiv class=\"footnotes\"\u003e\n\u003chr\u003e\n\u003col\u003e\n\u003cli id=\"fn-1\"\u003e\u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsup\u003e\u003cmi\u003eα\u003c/mi\u003e\u003cmrow\u003e\u003cmo\u003e−\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/mrow\u003e\u003c/msup\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmi\u003eA\u003c/mi\u003e\u003cmi\u003ec\u003c/mi\u003e\u003cmi\u003ek\u003c/mi\u003e\u003cmi\u003ee\u003c/mi\u003e\u003cmi\u003er\u003c/mi\u003e\u003cmi\u003em\u003c/mi\u003e\u003cmi\u003ea\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo separator=\"true\"\u003e,\u003c/mo\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\alpha^{-1}(n) = Ackerman(n, n)\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.0037em;\"\u003eα\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.8141079999999999em;\"\u003e\u003cspan style=\"top:-3.063em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e−\u003c/span\u003e\u003cspan class=\"mord mtight\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003en\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eA\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ec\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.03148em;\"\u003ek\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\"\u003eer\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eman\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003en\u003c/span\u003e\u003cspan class=\"mpunct\"\u003e,\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003en\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e. 経路圧縮とrankどちらかのみの場合はならし計算量\u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eO\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003el\u003c/mi\u003e\u003cmi\u003eo\u003c/mi\u003e\u003cmi\u003eg\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eO(log n)\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\"\u003eO\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.01968em;\"\u003el\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eo\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.03588em;\"\u003eg\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003en\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e.\u003ca href=\"#fnref-1\" class=\"footnote-backref\"\u003e↩\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/div\u003e","description":"rankしかもってなかった","commits":[{"title":"copy md","date":"2021-01-30 22:18:17","hash":"35b550ae","diff":"\u003cdiv class=\"remark-highlight\"\u003e\u003cpre data-file=\"35b550ae.patch\" class=\"language-git  language-diff\"\u003e\u003ccode class=\"language-git\"\u003e\u003cspan class=\"token commit-sha1\"\u003ecommit 35b550ae83af4efaeadf33471c8ca8a32c1079c8\u003c/span\u003e\nAuthor: koka \u0026#x26;\u003ca href=\"mailto:lt;koka.code@gmail.com\" class=\"token email-link\"\u003elt;koka.code@gmail.com\u003c/a\u003e\u0026#x26;gt;\nDate:   Sat Jan 30 22:18:17 2021 +0900\n\n  copy md\n\ndiff --git a/_posts/2019-03-08-unionfind.md b/_posts/2019-03-08-unionfind.md\nnew file mode 100644\nindex 0000000..dc993c9\n\u003cspan class=\"token deleted\"\u003e--- /dev/null\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+++ b/_posts/2019-03-08-unionfind.md\u003c/span\u003e\n\u003cspan class=\"token coord\"\u003e@@ -0,0 +1,163 @@\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+---\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+title: UnionFind\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+date: 2019-03-08\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+categories:\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+- Competitive Programming\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+tags:\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+- Graph\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+- TODO\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+description: rankしかもってなかった\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+---\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+[AtCoder Beginners Contest 120](https://atcoder.jp/contests/abc120) で連結成分のsizeを計算するdisjoint-setの問題が出題された.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+それまでrankを用いたUnion-Findしか経験がなかったので, この機会にまとめる.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+## Union-Find\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+Union-Findは要素が同一の集合に含まれるかどうかを判定するデータ構造.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+| Query      | Process       |\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+|------------|---------------|\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+| unite(x, y)|X(x $\\in$ X)とY(y $\\in$ Y)をマージする |\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+| same(x, y) |X == Y か判定する   |\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+の操作を\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+各要素を1つのノード, 集合を木と表現する.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+要素が同一の集合に含まれる場合, それらの要素は同一の木のノードである.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+上記操作をならし計算量$O(\\alpha(n))$で行う[^1]ためのマージ戦略が以下の経路圧縮とrankである.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### 経路圧縮\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+要素が同一の木のノードであるか判定する場合, 各要素のrootが同一かどうか見ればよい.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ただその場合木の高さだけ再帰的に親ノードを辿る必要がある.  \u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+そこで, 親ノードを調べる際に調べたノードをrootに直接つなぎ直すことで,次回以降の判定時の計算量を$O(1)$に削減する.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### Rank\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$unite()$操作時に木の高さが高い方を親として, 低い方を高い方に繋げるようにする.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ここで, 経路圧縮と併用する場合には圧縮前の高さでrankを持つ必要がある.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+経路圧縮は$find()$操作時に行うため, $unite()$の段階では必ずしも木の高さが$1$となっている保証はない.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u0026#x26;lt;details\u0026#x26;gt;\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u0026#x26;lt;summary\u0026#x26;gt;以下は経路圧縮のみの実装例.\u0026#x26;lt;/summary\u0026#x26;gt;\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u0026#x26;lt;div\u0026#x26;gt;\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```rust\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+struct UnionFind {\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+  par: Vec\u0026#x26;lt;usize\u0026#x26;gt;,\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+}\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+impl UnionFind {\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+  fn new(n: usize) -\u0026#x26;gt; Self {\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    UnionFind {\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+      par: (0..n).collect(),\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    }\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+  }\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+  fn unite(\u0026#x26;mut self, x: usize, y: usize) {\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    let px = self.find(x);\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    let py = self.find(y);\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    if px == py { return; }\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    self.par[py] = px;\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+  }\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+  fn same(\u0026#x26;mut self, x: usize, y: usize) -\u0026#x26;gt; bool {\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    self.find(x) == self.find(y)\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+  }\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+  fn find(\u0026#x26;mut self, x: usize) -\u0026#x26;gt; usize {\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    if self.par[x] == x { x }\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    else {\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+      // 経路圧縮\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+      let p = self.par[x];\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+      self.par[x] = self.find(p);\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+      self.par[x]\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    }\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+  }\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+}\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u0026#x26;lt;/div\u0026#x26;gt;\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u0026#x26;lt;/details\u0026#x26;gt;\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+## [Decayed Bridges](https://atcoder.jp/contests/abc120/tasks/abc120_d)\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+本題.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$n$頂点$m$辺の無向単純グラフの辺$i \\in M$を順番に取り除いたとき, 時刻$i$でアクセスできない頂点が何組あるか.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### かんがえたこと\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+Union-Findでは要素を統合することはできても分割操作は行えない.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+辺を除去する操作を考える場合にはグラフ全体を保持する必要が出てきてしまう. でも$n, m \\leq 10^5$で隣接グラフを持つのはエグいし連結判定が厳しい.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+では操作を巻き戻すとどうなるかを考えた.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+まず辺をすべて取り除いた状態から開始し，辺を追加していく.  \u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+このアプローチならUnion-Findで管理できる.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+辺を追加することで$a$頂点と$b$頂点が新たに連結されたとすると, アクセスできる頂点ペアは$a * b$個増える.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+この連結された頂点の増加判定は$same$操作を$unite$操作の前後に行うことで行える.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+が, Union-Findで集合の要素数を持つケースを初めて見たのでやや手間取った. 本番では構造体に要素数`siz`を`Vec`で保持させて$unite$時に更新してなんとかなった.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+::: tip 追記\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+この辺が存在した場合の連結する頂点数を考えると, $n * (n - 1) / 2$なのでここから引いてくと楽.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+:::\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u0026#x26;lt;details\u0026#x26;gt;\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u0026#x26;lt;summary\u0026#x26;gt;解答\u0026#x26;lt;/summary\u0026#x26;gt;\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u0026#x26;lt;div\u0026#x26;gt;\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```rust\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+fn main() {\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    let (n, m) = {\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+        let i = read::\u0026#x26;lt;usize\u0026#x26;gt;();\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+        (i[0], i[1])\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    };\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    let mut ab = Vec::new();\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    for _ in 0..m {\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+        let (a, b) = {\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+            let i = read::\u0026#x26;lt;usize\u0026#x26;gt;();\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+            (i[0], i[1])\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+        };\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+        ab.push((a, b));\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    }\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    let mut uf = UnionFind::new(n + 1);\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    let mut cost = n * (n - 1) / 2;\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    let mut ans = Vec::new();\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    for (a, b) in ab.into_iter().rev() {\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+        ans.push(cost);\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+        if uf.same(a, b) { continue; }\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+        let pa = uf.find(a);\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+        let pb = uf.find(b);\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+        let c = uf.siz[pa] * uf.siz[pb];\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+        uf.unite(a, b);\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+        cost -= c;\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    }\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    for a in ans.iter().rev() {\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+        println!(\"{}\", a);\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    }\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+}\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u0026#x26;lt;/div\u0026#x26;gt;\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u0026#x26;lt;/details\u0026#x26;gt;\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+## 所感\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+unite by rankとunite by sizeは本質的には同じなので落ち着いて対処したかった.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+またrankに符号付き整数を用いて, 正負でsize or rankを表すテクもあることを知った.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+::: tip TODO\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+basic ([Bridge/ABC075](https://atcoder.jp/contests/abc075/tasks/abc075_c))  \u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+weighted(Potential) Union-Find ([People on a line/ABC087](https://atcoder.jp/contests/abc087/tasks/arc090_b))  \u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+永続UF ([Stamp Rally/AGC002](https://agc002.contest.atcoder.jp/tasks/agc002_d))  \u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+わからん ([Nuske vs Phantom Thnook/AGC015](https://agc015.contest.atcoder.jp/tasks/agc015_c))\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+:::\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+[^1]: $\\alpha^{-1}(n) = Ackerman(n, n)$. 経路圧縮とrankどちらかのみの場合はならし計算量$O(log n)$.\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e"}],"publishedAt":"2019-03-08","updatedAt":"2021-01-30"}},"__N_SSG":true},"page":"/archives/[slug]","query":{"slug":"2019-03-08-unionfind"},"buildId":"_njc3MGNpGe_FGkG-cKkB","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>